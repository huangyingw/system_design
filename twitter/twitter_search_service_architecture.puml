@startuml

skinparam backgroundColor #D3D3D3
skinparam defaultFontName "Arial"
skinparam defaultFontSize 16
skinparam note {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontSize 16
  FontName "Arial"
}

title Twitter Search Service Architecture

rectangle "Client" as Client

rectangle "Search Service" as Search {
    rectangle "Request Handler" as RH
    rectangle "Query Parser" as QP
    rectangle "Cache Query" as CQ
    rectangle "Index Query" as IQ {
        rectangle "Search Index" as Index {
            rectangle "Elasticsearch" as ES
        }
    }
    rectangle "Result Handler" as RHdl {
        rectangle "Result Sorting & Filtering" as RSF
        rectangle "Result Caching" as RC
    }
    rectangle "Cache (Redis Cluster)" as Cache {
        rectangle "Search Result Cache" as SRC
    }
}

Client -> RH : Sends Search Request
RH -> QP : Parses Query
QP -> CQ : Queries Cache
CQ -> SRC : Reads from Cache

alt "Cache Hit"
    SRC -> CQ : Returns Cached Results
    CQ -> RH : Returns Cached Results
    RH -> Client : Returns Search Results
else "Cache Miss"
    CQ -> IQ : Queries Index
    IQ -> ES : Queries Elasticsearch
    ES -> IQ : Returns Search Results
    IQ -> RSF : Sorts & Filters Results
    RSF -> RC : Caches Results
    RC -> SRC : Stores in Cache
    RC -> RH : Returns Results
    RH -> Client : Returns Search Results
end

note right of Search
  **性能优化**:
  - 使用缓存（Redis）减少重复查询
  - 使用Elasticsearch提高搜索查询速度
  - 查询解析和结果排序优化
end note

@enduml
