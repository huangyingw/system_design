@startuml
skinparam backgroundColor #D3D3D3
skinparam defaultFontName "Arial"
skinparam defaultFontSize 16
skinparam note {
  BackgroundColor #FFFACD
  BorderColor #DAA520
  FontSize 14
  FontName "Arial"
}
title Twitter Search Service Architecture

rectangle "Client" as Client

rectangle "Search Service" as Search {
    rectangle "Request Handler" as RH
    rectangle "Query Parser" as QP
    rectangle "Spell Check & Auto-complete" as SCAC
    rectangle "Cache Query" as CQ
    rectangle "Index Query" as IQ
    rectangle "Result Handler" as RHdl {
        rectangle "Result Sorting & Filtering" as RSF
        rectangle "Result Caching" as RC
    }
}

rectangle "Cache (Redis Cluster)" as Cache {
    rectangle "Search Result Cache" as SRC
}

rectangle "Search Index" as Index {
    rectangle "Elasticsearch" as ES
}

Client -down-> RH : Sends Search Request
RH -down-> QP : Parses Query
QP -down-> SCAC : Checks Spelling & Suggests
SCAC -down-> CQ : Queries Cache
CQ -right-> SRC : Reads from Cache
SRC -left-> CQ : Returns Results (Hit/Miss)
CQ -down-> IQ : Queries Index (if Cache Miss)
IQ -right-> ES : Queries Elasticsearch
ES -left-> IQ : Returns Search Results
IQ -up-> RSF : Sorts & Filters Results
RSF -right-> RC : Caches Results
RC -up-> SRC : Stores in Cache
RHdl -up-> RH : Returns Results
RH -up-> Client : Returns Search Results

note right of Search
  **性能优化**:
  - 使用缓存（Redis）减少重复查询
  - 使用Elasticsearch提高搜索查询速度
  - 查询解析和结果排序优化
end note

note right of SCAC
  提供拼写纠正和自动补全功能，
  改善用户搜索体验
end note
@enduml
