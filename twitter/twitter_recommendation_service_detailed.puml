@startuml Twitter_Recommendation_Service_Detailed

!define LIGHTYELLOW #FFFACD
!define LIGHTGREEN #90EE90
!define LIGHTRED #FFB6C1

skinparam backgroundColor #E6F3FF
skinparam shadowing false
skinparam RoundCorner 8
skinparam ArrowColor 454645
skinparam DefaultFontName Arial
skinparam DefaultFontSize 11

allowmixing

component "Recommendation Service" as RecommendationService #90EE90 {
    component "Recommendation Engine" as RE
    component "Result Caching" as REC
    component "Push Notification Service" as PNS
    component "Real-time Recommendation Engine" as RRE
}

component "Data Analysis" as DataAnalysis #90EE90
component "Cache" as Cache #FFFACD {
    component "Recommendation Cache" as RCache
}
component "Database" as Database #FFFACD {
    component "User Interaction Data" as UID
    component "Content Data" as CD
}
component "API Gateway" as APIGateway #FFFACD

' Recommendation Service Flow
RE -down-> UID : Fetch user data
RE -down-> CD : Fetch content data
RE -up-> REC : Cache recommendations
REC -down-> RCache : Store recommendations in cache
PNS -down-> RCache : Fetch recommendations from cache
PNS -right-> APIGateway : Push recommendations
RRE -down-> UID : Analyze real-time data
RRE -up-> REC : Update recommendations

DataAnalysis -down-> Database : Analyze user behavior

note right of RecommendationService
  性能优化:
  - 使用缓存减少推荐计算
  - 优化推荐算法
  - 增加推荐引擎计算资源
end note

note right of RRE
  基于用户实时行为进行推荐，
  提高推荐的时效性和准确性
end note

note right of Database
  Scalability concern:
  Implement sharding
end note

@enduml
