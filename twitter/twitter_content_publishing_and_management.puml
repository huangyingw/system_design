@startuml

!pragma layout dot
skinparam backgroundColor #F0F0F0
allowmixing

' 增加字体大小
skinparam defaultFontSize 18
skinparam noteFontSize 18
skinparam titleFontSize 24

title Twitter Content Publishing and Management System

rectangle "Client Applications" as Client #E6F3FF
rectangle "API Gateway" as AG #D6EAF8
rectangle "Load Balancer" as LB #D6EAF8

rectangle "Content Service" as CS #E8F8F5 {
    component "Tweet Creation" as TC #ABEBC6
    component "Tweet Editing" as TE #ABEBC6
    component "Tweet Deletion" as TD #ABEBC6
    component "Media Upload" as MU #ABEBC6
    component "Content Cache" as CC #F9E79F
}

rectangle "Moderation Service" as MS #FDEDEC {
    component "Content Moderation" as CM #F5B7B1
    component "Report Handling" as RH #F5B7B1
    component "Automated Filtering" as AF #F5B7B1
}

rectangle "User Service" as US #E8DAEF {
    component "Authentication" as Auth #D2B4DE
    component "Authorization" as Authz #D2B4DE
    component "User Profile" as UP #D2B4DE
}

rectangle "Analytics Service" as AS #FCF3CF {
    component "Engagement Tracking" as ET #F9E79F
    component "Trend Analysis" as TA #F9E79F
}

rectangle "Data Persistence Layer" as DPL #D5D8DC {
    component "Tweet Data (DB)" as TDB #ABB2B9
    component "Media Data (Object Storage)" as MDB #ABB2B9
    component "User Data (DB)" as UDB #ABB2B9
    component "Analytics Data (Data Warehouse)" as ADB #ABB2B9
}

rectangle "Message Queue" as MQ #F8C471
rectangle "CDN" as CDN #AED6F1

Client -[#1E90FF,thickness=2]down-> AG : <back:#FFFFFF><color:#1E90FF>1. API Requests</color></back>
AG -[#1E90FF,thickness=2]down-> LB : <back:#FFFFFF><color:#1E90FF>2. Route Requests</color></back>
LB -[#1E90FF,thickness=2]down-> CS : <back:#FFFFFF><color:#1E90FF>3. Distribute Load</color></back>
LB -[#1E90FF,thickness=2]down-> MS : <back:#FFFFFF><color:#1E90FF>3. Distribute Load</color></back>
LB -[#1E90FF,thickness=2]down-> US : <back:#FFFFFF><color:#1E90FF>3. Distribute Load</color></back>

CS -[#2ECC71,thickness=2]right-> US : <back:#FFFFFF><color:#2ECC71>4. Authenticate/Authorize</color></back>
CS -[#2ECC71,thickness=2]down-> CC : <back:#FFFFFF><color:#2ECC71>5. Check Cache</color></back>
CC -[#2ECC71,thickness=2]down-> TDB : <back:#FFFFFF><color:#2ECC71>6. Cache Miss</color></back>
CS -[#2ECC71,thickness=2]down-> MQ : <back:#FFFFFF><color:#2ECC71>7. Publish Events</color></back>
MQ -[#2ECC71,thickness=2]right-> MS : <back:#FFFFFF><color:#2ECC71>8. Consume Moderation Events</color></back>
MQ -[#2ECC71,thickness=2]right-> AS : <back:#FFFFFF><color:#2ECC71>8. Consume Analytics Events</color></back>

MS -[#E74C3C,thickness=2]down-> AF : <back:#FFFFFF><color:#E74C3C>9. Auto-filter Content</color></back>
MS -[#E74C3C,thickness=2]down-> CM : <back:#FFFFFF><color:#E74C3C>10. Human Moderation</color></back>
MS -[#E74C3C,thickness=2]right-> RH : <back:#FFFFFF><color:#E74C3C>11. Handle Reports</color></back>

AS -[#F39C12,thickness=2]down-> ET : <back:#FFFFFF><color:#F39C12>12. Track Engagement</color></back>
AS -[#F39C12,thickness=2]right-> TA : <back:#FFFFFF><color:#F39C12>13. Analyze Trends</color></back>

MU -[#3498DB,thickness=2]down-> CDN : <back:#FFFFFF><color:#3498DB>14. Store Media</color></back>
CDN -[#3498DB,thickness=2]down-> MDB : <back:#FFFFFF><color:#3498DB>15. Backup Media</color></back>

note right of CS
  <b>Performance Optimization:</b>
  - Implement distributed caching (e.g., Redis)
  - Use read replicas for database
  - Implement database sharding for scalability
end note

note bottom of MS
  <b>Moderation Enhancements:</b>
  - Implement ML-based content classification
  - Set up real-time alerting for sensitive content
end note

note right of AS
  <b>Analytics Improvements:</b>
  - Use stream processing for real-time analytics
  - Implement data lake for long-term storage and analysis
end note

note bottom of DPL
  <b>Data Management:</b>
  - Implement data retention policies
  - Set up regular backups and disaster recovery
end note

@enduml
