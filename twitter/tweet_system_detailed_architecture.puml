@startuml

skinparam backgroundColor #D3D3D3
skinparam defaultFontName "Arial"
skinparam defaultFontSize 16
skinparam note {
  BackgroundColor #FFFACD
  BorderColor #DAA520
  FontSize 14
  FontName "Arial"
}

title Enhanced Twitter System Architecture with Scalability and Performance Strategies

rectangle "Client" as Client

rectangle "Core Services" as Core {
    rectangle "Load Balancer & Web Server" as LBWS {
        rectangle "Load Balancer" as LB
        rectangle "Web Server" as WS
    }
    rectangle "Application & Monitoring Services" as AMS {
        rectangle "Application Server" as AS
        rectangle "Service Circuit Breaker" as SCB
        rectangle "Service Auto-Scaling" as SAS
    }
}

rectangle "Tweet Processing Service" as TPS {
    rectangle "Tweet & Comment Handlers" as TCH {
        rectangle "Text Processing" as TP
        rectangle "Sensitive Word Filtering" as SWF
    }
    rectangle "Async Processing Queue (Kafka/RabbitMQ)" as APQ
    rectangle "Workers for Processing" as Workers {
        rectangle "Task Processing" as TProc
        rectangle "Database Update" as DBU
        rectangle "Cache Update" as CU
    }
}

rectangle "Supporting Services" as SS {
    rectangle "Search Service" as SSrv
    rectangle "Notification Service" as NSrv
    rectangle "Timeline Update Service" as TUS
    rectangle "Content Delivery Network" as CDN
}

rectangle "Data Persistence Layer" as DPS {
    rectangle "Caching (Redis Cluster)" as Cache {
        rectangle "Tweet & Timeline Caches" as TTC
        rectangle "Edge Caching (CDN)" as EC
    }
    rectangle "Databases (Sharded & Read-Replica)" as DB {
        rectangle "Tweet & Comment Data" as TCD
        rectangle "Data Partitioning & Sharding" as DPSH
    }
}

' Define data flows
Client -down-> LBWS : Sends Request
LBWS -down-> AMS : Routes Request
AMS -right-> TCH : Handles Tweet/Comment
TCH -down-> APQ : Queues Tasks
APQ -down-> Workers : Processes Tasks
Workers -down-> DPS : Updates Data
Workers -left-> SSrv : Updates Search
Workers -left-> NSrv : Notifies
TUS -down-> DPS : Updates Timelines
Client -left-> LBWS : Requests Timeline
AMS -down-> TUS : Fetches Timeline Data
TUS -left-> Cache : Checks Cache
Cache -down-> TUS : Returns Cached Data
TUS -up-> AMS : Returns Timeline Data
AMS -up-> LBWS : Sends Back Data
LBWS -up-> Client : Returns Data/Updates Timeline
CDN -[hidden]right-> SSrv

note right of LB
  **Load Balancer Optimization**:
  - High-performance load balancer
  - Multiple instance deployment
end note

note right of Cache
  **Cache Optimization**:
  - Redis for caching hot data
  - CDN for caching static resources
end note

note right of DB
  **Database Optimization**:
  - Sharding and read-write separation
  - Index optimization for queries
end note

note right of APQ
  **Asynchronous Processing**:
  - Use message queues
  - Increase number of consumers
end note

note right of AMS
  **Auto Scaling**:
  - Configure auto-scaling strategies
end note

note right of CDN
  Use CDN to accelerate static content and media file delivery,
  improving global user access speed
end note

@enduml
