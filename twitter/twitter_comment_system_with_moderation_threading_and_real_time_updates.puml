@startuml ' ==================== Metadata ====================
' ==================== Enhanced Metadata ====================
' === 基础分类 ===
' @category: distributed-systems
' @subcategory: message-queue
' @tags: #kafka, #message-queue, #event-streaming, #distributed-systems
' @description: Twitter Comment System With Moderation Threading And Real Time Updates
'
' === 应用场景 ===
' @application: Twitter
' @industry: Social Media
' @use-cases: Real-time Processing, Data Analytics, System Monitoring, Search & Discovery, Log Aggregation
' @business-value: Improved scalability, High availability, Better performance, Cost efficiency
'
' === 技术栈 ===
' @tech-stack: Kafka, ZooKeeper, Redis, Elasticsearch, MySQL/PostgreSQL, Prometheus, Grafana, Cassandra
' @programming-languages: Language-agnostic
' @frameworks: Framework-agnostic
' @protocols: HTTP/REST
' @apis: REST API
'
' === 架构模式 ===
' @pattern: Event-Driven Architecture, API Gateway
' @design-pattern: Observer, Producer-Consumer, Repository, Factory
' @data-flow: Bidirectional, Request-Response
' @communication-style: Asynchronous, Synchronous, Event-driven
'
' === 分布式特性 ===
' @cap-focus: AP (Availability + Partition Tolerance)
' @consistency-model: Eventual Consistency (configurable)
' @consensus-algorithm: Raft, Leader Election
' @partition-strategy: Hash-based, Key-based, Custom partitioning
'
' === 性能与扩展 ===
' @scale: Medium to Large (1K-100K users, 100-10K QPS)
' @scalability: Horizontal scaling, Auto-scaling, Load balancing
' @performance-metrics: Throughput: 1M+ msg/s, Latency: <10ms p99
' @optimization-techniques: Caching
' @throughput: Very High (1M+ messages/second)
' @latency: Low (<10ms p99)
'
' === 可靠性 ===
' @reliability: Replication, Redundancy, Health checks, Automatic recovery
' @fault-tolerance: Replication, Failover, Health monitoring, Graceful degradation
' @disaster-recovery: Multi-datacenter replication, Backup strategies, RPO/RTO management
' @availability: 99.99% (4 nines)
' @data-durability: 99.999999999% (11 nines) with proper replication
'
' === 安全性 ===
' @security-features: Authentication
' @authentication: OAuth 2.0, JWT, API Keys, SASL
' @authorization: RBAC (Role-Based Access Control), ACLs, Policy-based
' @encryption: TLS (in-transit), Optional encryption at rest
' @compliance: GDPR-ready, SOC2, HIPAA-compatible, PCI-DSS
'
' === 存储 ===
' @storage-type: Log Storage
' @database-type: SQL/Relational, NoSQL, In-Memory, Search Engine
' @caching-strategy: Cache-aside, Write-through, TTL-based expiration
' @data-persistence: Disk-based with WAL, Configurable durability, Snapshot backups
'
' === 监控运维 ===
' @monitoring: Prometheus, ELK Stack
' @logging: Centralized logging (ELK/Splunk), Structured logs, Log aggregation
' @alerting: Prometheus Alertmanager, PagerDuty, Custom alerts, SLA monitoring
' @observability: Metrics (RED/USE), Logs, Distributed tracing (Jaeger/Zipkin)
'
' === 部署 ===
' @deployment: Kubernetes, Docker, Cloud-native, Blue-Green deployment
' @infrastructure: Cloud, On-premise, Hybrid, Multi-cloud
' @cloud-provider: AWS, Azure, GCP, Cloud-agnostic
' @containerization: Docker-ready, Container-friendly
'
' === 成本 ===
' @cost-factors: Compute instances, Storage costs, Network bandwidth, Licensing
' @cost-optimization: Reserved instances, Auto-scaling, Storage tiering, Compression, Resource right-sizing
' @resource-usage: CPU: Medium-High, Memory: Medium-High, Disk I/O: High, Network: Medium
'
' === 复杂度 ===
' @complexity: Medium
' @implementation-difficulty: Medium
' @maintenance-complexity: Medium
'
' === 学习 ===
' @difficulty-level: Intermediate
' @learning-value: Medium to High (practical system design)
' @prerequisites: Message queues, Pub-Sub pattern, Database fundamentals, SQL/NoSQL
' @related-concepts: Event sourcing, CQRS, Caching strategies, Cache invalidation
'
' === 数据特征 ===
' @data-volume: Medium to Large (GBs to TBs)
' @data-velocity: Real-time, High-speed streaming
' @data-variety: Structured, Semi-structured (JSON, Avro)
' @data-model: Document, Key-Value, Relational, Time-series
'
' === 集成 ===
' @integration-points: REST APIs, Message queues, Database connectors, Webhooks
' @third-party-services: Cloud storage, CDN, Payment processors, Analytics services
' @external-dependencies: Minimal external dependencies
'
' === 测试 ===
' @testing-strategy: Unit tests, Integration tests, Load tests, Chaos engineering
' @quality-assurance: CI/CD pipelines, Code review, Static analysis, Performance testing
'
' === 版本 ===
' @version: 1.0 (current design)
' @maturity: Production-ready, Battle-tested
' @evolution-stage: Active development, Continuous improvement
'
' === 关联 ===
' @related-files: See other architecture diagrams in the same directory
' @alternatives: Multiple implementation approaches available
' @comparison-with: Traditional monolithic vs distributed approaches
'
' === 实战 ===
' @real-world-examples: LinkedIn, Netflix, Uber, Airbnb
' @companies-using: LinkedIn, Netflix, Uber, Airbnb
' @production-readiness: Production-ready, Battle-tested at scale, Enterprise-grade
' ==================================================


!pragma layout dot
allowmixing
skinparam backgroundColor #E8E8E8

rectangle "Client Layer" as ClientLayer #FFFACD {
    component "Web App" as WebApp #87CEFA
    component "Mobile App" as MobileApp #98FB98
}

rectangle "API Gateway Layer" as GatewayLayer #FFE4B5 {
    component "API Gateway" as APIGateway #F0E68C
    component "Load Balancer" as LoadBalancer #DDA0DD
}

rectangle "Service Layer" as ServiceLayer #E6E6FA {
    component "User Service" as UserService #ADD8E6
    component "Tweet Service" as TweetService #90EE90
    component "Comment Service" as CommentService #FFA07A
    component "Notification Service" as NotificationService #F0E68C
    component "Search Service" as SearchService #D8BFD8
}

rectangle "Caching Layer" as CachingLayer #FFE4E1 {
    component "Redis Cache" as CacheService #FF6347
    component "Rate Limiter" as RateLimiter #4682B4
}

rectangle "Database Layer" as DatabaseLayer #F0FFF0 {
    component "PostgreSQL" as SQLDatabase #6495ED
    component "Cassandra" as NoSQLDatabase #9ACD32
    component "Elasticsearch" as ElasticsearchDB #FFA500
}

rectangle "Messaging Layer" as MessagingLayer #F5DEB3 {
    component "Kafka" as Kafka #FF4500
}

rectangle "Monitoring Layer" as MonitoringLayer #E0FFFF {
    component "Prometheus" as Prometheus #B0C4DE
    component "ELK Stack" as ELKStack #20B2AA
}

ClientLayer -[#000000,thickness=2]down-> GatewayLayer : <back:#FFFFFF><color:#000000>1. HTTP/HTTPS Requests</color></back>

GatewayLayer -[#0000FF,thickness=2]down-> ServiceLayer : <back:#FFFFFF><color:#0000FF>2. Route Requests</color></back>

ServiceLayer -[#008000,thickness=2]right-> CachingLayer : <back:#FFFFFF><color:#008000>3. Check Cache/Rate Limit</color></back>

CachingLayer -[#FF0000,thickness=2]down-> DatabaseLayer : <back:#FFFFFF><color:#FF0000>4. Cache Miss</color></back>

ServiceLayer -[#800080,thickness=2]down-> DatabaseLayer : <back:#FFFFFF><color:#800080>5. CRUD Operations</color></back>

ServiceLayer -[#FFA500,thickness=2]down-> MessagingLayer : <back:#FFFFFF><color:#FFA500>6. Publish Events</color></back>

MessagingLayer -[#8B4513,thickness=2]up-> ServiceLayer : <back:#FFFFFF><color:#8B4513>7. Consume Events (Async)</color></back>

MonitoringLayer -[#4B0082,thickness=2]up-> ServiceLayer : <back:#FFFFFF><color:#4B0082>8. Monitor & Log</color></back>

ServiceLayer -[#006400,thickness=2]up-> GatewayLayer : <back:#FFFFFF><color:#006400>9. Return Response</color></back>

GatewayLayer -[#8B0000,thickness=2]up-> ClientLayer : <back:#FFFFFF><color:#8B0000>10. Send Response to Client</color></back>

note right of ClientLayer
  Supports web and mobile clients
end note

note right of APIGateway
  Handles authentication, rate limiting,
  and request routing
end note

note right of CommentService
  Manages CRUD operations for comments,
  integrates with other services
end note

note top of CacheService
  key: tweet_id
  value: {comments, metadata}
end note

note top of NoSQLDatabase
  Stores high-volume comment data
end note

note top of Kafka
  Enables asynchronous communication
  between services
end note

note right of Prometheus
  Collects metrics for real-time
  monitoring and alerting
end note

note right of ELKStack
  Centralized logging and analysis
end note

@enduml
