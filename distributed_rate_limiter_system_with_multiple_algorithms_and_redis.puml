@startuml ' ==================== Metadata ====================
' ==================== Enhanced Metadata ====================
' === 基础分类 ===
' @category: microservices
' @subcategory: api-gateway
' @tags: #api-gateway, #microservices, #routing, #authentication
' @description: Distributed Rate Limiter System With Multiple Algorithms And Redis
'
' === 应用场景 ===
' @application: General
' @industry: General, Enterprise
' @use-cases: System Monitoring
' @business-value: Improved scalability, High availability, Better performance, Cost efficiency
'
' === 技术栈 ===
' @tech-stack: Redis, Prometheus, Grafana, gRPC
' @programming-languages: Go
' @frameworks: Framework-agnostic
' @protocols: HTTP/REST, gRPC
' @apis: REST API, WebSocket, gRPC
'
' === 架构模式 ===
' @pattern: Circuit Breaker, API Gateway
' @design-pattern: Observer, Producer-Consumer, Repository, Factory
' @data-flow: Bidirectional, Request-Response
' @communication-style: Asynchronous, Synchronous
'
' === 分布式特性 ===
' @cap-focus: AP (configurable)
' @consistency-model: Eventual Consistency (configurable)
' @consensus-algorithm: Raft, Leader Election
' @partition-strategy: Hash-based, Key-based, Custom partitioning
'
' === 性能与扩展 ===
' @scale: Medium to Large (1K-100K users, 100-10K QPS)
' @scalability: Horizontal scaling, Auto-scaling, Load balancing
' @performance-metrics: Response time: <200ms p95, 10K+ QPS
' @optimization-techniques: Caching, Batch processing
' @throughput: Medium to High (10K-100K requests/second)
' @latency: Medium (<200ms p95)
'
' === 可靠性 ===
' @reliability: Replication, Redundancy, Health checks, Automatic recovery
' @fault-tolerance: Replication, Circuit breaker
' @disaster-recovery: Multi-datacenter replication, Backup strategies, RPO/RTO management
' @availability: 99.99% (4 nines)
' @data-durability: 99.999999999% (11 nines) with proper replication
'
' === 安全性 ===
' @security-features: Authentication, Authorization, Encryption, Audit logging
' @authentication: OAuth 2.0, JWT, API Keys, SASL
' @authorization: RBAC (Role-Based Access Control), ACLs, Policy-based
' @encryption: TLS (in-transit), Optional encryption at rest
' @compliance: GDPR-ready, SOC2, HIPAA-compatible, PCI-DSS
'
' === 存储 ===
' @storage-type: Distributed Storage, Replicated Storage
' @database-type: In-Memory
' @caching-strategy: Cache-aside, Write-through, TTL-based expiration
' @data-persistence: Disk-based with WAL, Configurable durability, Snapshot backups
'
' === 监控运维 ===
' @monitoring: Prometheus, Grafana
' @logging: Centralized logging (ELK/Splunk), Structured logs, Log aggregation
' @alerting: Prometheus Alertmanager, PagerDuty, Custom alerts, SLA monitoring
' @observability: Metrics (RED/USE), Logs, Distributed tracing (Jaeger/Zipkin)
'
' === 部署 ===
' @deployment: Cloud-native
' @infrastructure: Cloud, On-premise, Hybrid, Multi-cloud
' @cloud-provider: AWS, Azure, GCP, Cloud-agnostic
' @containerization: Docker-ready, Container-friendly
'
' === 成本 ===
' @cost-factors: Compute instances, Storage costs, Network bandwidth, Licensing
' @cost-optimization: Reserved instances, Auto-scaling, Storage tiering, Compression, Resource right-sizing
' @resource-usage: CPU: Medium-High, Memory: Medium-High, Disk I/O: High, Network: Medium
'
' === 复杂度 ===
' @complexity: Very High
' @implementation-difficulty: High to Very High
' @maintenance-complexity: High
'
' === 学习 ===
' @difficulty-level: Expert
' @learning-value: Very High (advanced distributed systems concepts)
' @prerequisites: Basic system design, Networking, Data structures
' @related-concepts: Replication strategies, Caching strategies, Cache invalidation
'
' === 数据特征 ===
' @data-volume: Medium to Large (GBs to TBs)
' @data-velocity: Batch processing, Scheduled
' @data-variety: Structured, Semi-structured (JSON, Avro)
' @data-model: Document, Key-Value, Relational, Time-series
'
' === 集成 ===
' @integration-points: REST APIs, Message queues, Database connectors, Webhooks
' @third-party-services: Cloud storage, CDN, Payment processors, Analytics services
' @external-dependencies: Minimal external dependencies
'
' === 测试 ===
' @testing-strategy: Unit tests, Integration tests, Load tests, Chaos engineering
' @quality-assurance: CI/CD pipelines, Code review, Static analysis, Performance testing
'
' === 版本 ===
' @version: 1.0 (current design)
' @maturity: Production-ready, Battle-tested
' @evolution-stage: Active development, Continuous improvement
'
' === 关联 ===
' @related-files: See other architecture diagrams in the same directory
' @alternatives: Multiple implementation approaches available
' @comparison-with: Traditional monolithic vs distributed approaches
'
' === 实战 ===
' @real-world-examples: Fortune 500 companies, Tech unicorns, Large-scale enterprises
' @companies-using: Many Fortune 500 companies, Tech giants, Startups
' @production-readiness: Production-ready, Battle-tested at scale, Enterprise-grade
' ==================================================


skinparam componentStyle rectangle

package "Rate Limiter Service" {
    component "API Gateway" as Gateway
    
    package "Rate Limiter Core" {
        component "Token Bucket" as TokenBucket
        component "Leaky Bucket" as LeakyBucket
        component "Sliding Window" as SlidingWindow
        component "Fixed Window" as FixedWindow
        component "Algorithm Selector" as AlgorithmSelector
    }
    
    package "Redis Cluster" {
        component "Counter" as Counter
        component "Window" as Window
        component "Limits" as Limits
    }
    
    package "Configuration Service" {
        component "Rate Limit Rules" as Rules
        component "Service Configs" as ServiceConfigs
    }
    
    package "Monitoring & Alerts" {
        component "Prometheus" as Prom
        component "Grafana" as Graf
        component "Alert Manager" as Alert
    }
}

cloud "Client Applications" as Clients
cloud "Protected Services" as Services

Clients --> Gateway : HTTP/gRPC Requests
Gateway --> TokenBucket : Rate Check
TokenBucket --> Counter : Store/Retrieve
TokenBucket --> Rules : Load Rules
Alert --> TokenBucket : Collect Metrics
Gateway --> Services : Forward if Allowed

AlgorithmSelector --> TokenBucket
AlgorithmSelector --> LeakyBucket
AlgorithmSelector --> SlidingWindow
AlgorithmSelector --> FixedWindow

note right of TokenBucket
  Refills tokens at fixed rate
  Best for burst traffic
end note

note right of LeakyBucket
  Processes requests at constant rate
  Smooths out traffic spikes
end note

legend right
Implementation Details:
==
Redis Implementation:
- INCR for counters
- EXPIRE for window reset
- Lua scripts for atomic ops

High Availability:
- Redis cluster with replicas
- Circuit breaker pattern
- Fallback to local cache

Performance Optimizations:
- Local caching layer
- Batch counter updates
- Async monitoring
end legend

@enduml