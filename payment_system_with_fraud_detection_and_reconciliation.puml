@startuml Payment System
' ==================== Enhanced Metadata ====================
' === 基础分类 ===
' @category: distributed-systems
' @subcategory: message-queue
' @tags: #kafka, #message-queue, #event-streaming, #distributed-systems
' @description: Payment System With Fraud Detection And Reconciliation
'
' === 应用场景 ===
' @application: General
' @industry: Financial Services, Education
' @use-cases: Real-time Processing, Log Aggregation
' @business-value: Improved scalability, High availability, Better performance, Cost efficiency
'
' === 技术栈 ===
' @tech-stack: Kafka, ZooKeeper, Redis, MongoDB, MySQL/PostgreSQL
' @programming-languages: Go
' @frameworks: Framework-agnostic
' @protocols: HTTP/REST, TCP
' @apis: REST API
'
' === 架构模式 ===
' @pattern: API Gateway
' @design-pattern: Observer, Producer-Consumer, Repository, Factory
' @data-flow: Bidirectional, Request-Response
' @communication-style: Asynchronous
'
' === 分布式特性 ===
' @cap-focus: AP (Availability + Partition Tolerance)
' @consistency-model: Eventual Consistency (configurable)
' @consensus-algorithm: Raft, Leader Election
' @partition-strategy: Hash-based, Key-based, Custom partitioning
'
' === 性能与扩展 ===
' @scale: Medium to Large (1K-100K users, 100-10K QPS)
' @scalability: Horizontal scaling, Auto-scaling, Load balancing
' @performance-metrics: Throughput: 1M+ msg/s, Latency: <10ms p99
' @optimization-techniques: Caching, Batch processing
' @throughput: Very High (1M+ messages/second)
' @latency: Low (<10ms p99)
'
' === 可靠性 ===
' @reliability: Replication, Redundancy, Health checks, Automatic recovery
' @fault-tolerance: Automatic failover
' @disaster-recovery: Multi-datacenter replication, Backup strategies, RPO/RTO management
' @availability: 99.99% (4 nines)
' @data-durability: 99.999999999% (11 nines) with proper replication
'
' === 安全性 ===
' @security-features: Authentication, Authorization, Encryption, Audit logging
' @authentication: OAuth 2.0, JWT, API Keys, SASL
' @authorization: RBAC (Role-Based Access Control), ACLs, Policy-based
' @encryption: TLS (in-transit), Optional encryption at rest
' @compliance: GDPR-ready, SOC2, HIPAA-compatible, PCI-DSS
'
' === 存储 ===
' @storage-type: Log Storage
' @database-type: SQL/Relational, NoSQL, In-Memory
' @caching-strategy: Cache-aside, Write-through, TTL-based expiration
' @data-persistence: Disk-based with WAL, Configurable durability, Snapshot backups
'
' === 监控运维 ===
' @monitoring: Prometheus, Grafana, Custom metrics, Health checks
' @logging: Centralized logging (ELK/Splunk), Structured logs, Log aggregation
' @alerting: Prometheus Alertmanager, PagerDuty, Custom alerts, SLA monitoring
' @observability: Metrics (RED/USE), Logs, Distributed tracing (Jaeger/Zipkin)
'
' === 部署 ===
' @deployment: Kubernetes, Docker, Cloud-native, Blue-Green deployment
' @infrastructure: Cloud, On-premise, Hybrid, Multi-cloud
' @cloud-provider: AWS, Azure, GCP, Cloud-agnostic
' @containerization: Docker-ready, Container-friendly
'
' === 成本 ===
' @cost-factors: Compute instances, Storage costs, Network bandwidth, Licensing
' @cost-optimization: Reserved instances, Auto-scaling, Storage tiering, Compression, Resource right-sizing
' @resource-usage: CPU: Medium-High, Memory: Medium-High, Disk I/O: High, Network: Medium
'
' === 复杂度 ===
' @complexity: Medium
' @implementation-difficulty: Medium
' @maintenance-complexity: Medium
'
' === 学习 ===
' @difficulty-level: Intermediate
' @learning-value: Medium to High (practical system design)
' @prerequisites: Message queues, Pub-Sub pattern, Database fundamentals, SQL/NoSQL
' @related-concepts: Caching strategies, Cache invalidation
'
' === 数据特征 ===
' @data-volume: Medium to Large (GBs to TBs)
' @data-velocity: Real-time, High-speed streaming
' @data-variety: Structured, Semi-structured (JSON, Avro)
' @data-model: Document, Key-Value, Relational, Time-series
'
' === 集成 ===
' @integration-points: REST APIs, Message queues, Database connectors, Webhooks
' @third-party-services: Payment gateways (Stripe, PayPal)
' @external-dependencies: Minimal external dependencies
'
' === 测试 ===
' @testing-strategy: Unit tests, Integration tests, Load tests, Chaos engineering
' @quality-assurance: CI/CD pipelines, Code review, Static analysis, Performance testing
'
' === 版本 ===
' @version: 1.0 (current design)
' @maturity: Production-ready, Battle-tested
' @evolution-stage: Active development, Continuous improvement
'
' === 关联 ===
' @related-files: See other architecture diagrams in the same directory
' @alternatives: Multiple implementation approaches available
' @comparison-with: Traditional monolithic vs distributed approaches
'
' === 实战 ===
' @real-world-examples: LinkedIn, Netflix, Uber, Airbnb
' @companies-using: LinkedIn, Netflix, Uber, Airbnb
' @production-readiness: Production-ready, Battle-tested at scale, Enterprise-grade
' ==================================================



!include common_style.puml

title Payment System with Fraud Detection and Reconciliation

rectangle "Client Layer" {
    component "Payment Gateway API" as apiGateway
    component "Merchant Portal" as merchantPortal
    component "Admin Dashboard" as adminDashboard
}

rectangle "Payment Processing" {
    component "Payment Orchestrator" as paymentOrchestrator
    component "Payment Processor" as paymentProcessor
    component "Payment Router" as paymentRouter
    queue "Payment Queue\n(Kafka)" as paymentQueue
}

rectangle "Risk Management" {
    component "Fraud Detection" as fraudDetection
    component "Risk Scorer" as riskScorer
    component "Rule Engine" as ruleEngine
    database "Risk Rules\n(MongoDB)" as riskRules
}

rectangle "Payment Providers" {
    component "Credit Card Provider" as ccProvider
    component "Bank Transfer" as bankTransfer
    component "Digital Wallet" as digitalWallet
    component "Provider Adapter" as providerAdapter
}

rectangle "Storage Layer" {
    database "Transaction DB\n(PostgreSQL)" as transactionDB
    database "Account DB\n(PostgreSQL)" as accountDB
    database "Audit Log\n(MongoDB)" as auditLog
    database "Cache\n(Redis)" as cacheLayer
}

rectangle "Reconciliation" {
    component "Transaction Matcher" as txnMatcher
    component "Settlement Service" as settlementService
    component "Reporting Service" as reportingService
    database "Settlement DB\n(PostgreSQL)" as settlementDB
}

' Connections
apiGateway --> paymentOrchestrator
merchantPortal --> apiGateway
adminDashboard --> apiGateway

paymentOrchestrator --> fraudDetection
paymentOrchestrator --> paymentQueue
paymentQueue --> paymentProcessor

fraudDetection --> riskScorer
riskScorer --> ruleEngine
ruleEngine --> riskRules

paymentProcessor --> paymentRouter
paymentRouter --> providerAdapter
providerAdapter --> ccProvider
providerAdapter --> bankTransfer
providerAdapter --> digitalWallet

paymentProcessor --> transactionDB
paymentProcessor --> accountDB
paymentProcessor --> auditLog
paymentProcessor --> cacheLayer

paymentQueue --> txnMatcher
txnMatcher --> settlementService
settlementService --> settlementDB
reportingService --> settlementDB

note right of fraudDetection
  Real-time fraud detection
  Machine learning models
  Rule-based filtering
end note

note right of paymentRouter
  Provider selection
  Failover handling
  Load balancing
end note

note right of settlementService
  Batch processing
  Fee calculation
  Reconciliation
end note

note right of transactionDB
  ACID compliance
  Transaction history
  Payment state
end note

@enduml 