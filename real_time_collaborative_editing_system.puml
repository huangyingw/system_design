@startuml Real-time Collaborative Editing System
' ==================== Enhanced Metadata ====================
' === 基础分类 ===
' @category: microservices
' @subcategory: api-gateway
' @tags: #api-gateway, #microservices, #routing, #authentication
' @description: Real Time Collaborative Editing System
'
' === 应用场景 ===
' @application: General
' @industry: General, Enterprise
' @use-cases: Real-time Processing, Search & Discovery, Log Aggregation
' @business-value: Improved scalability, High availability, Better performance, Cost efficiency
'
' === 技术栈 ===
' @tech-stack: Redis, Elasticsearch, MongoDB, MySQL/PostgreSQL
' @programming-languages: Go
' @frameworks: Framework-agnostic
' @protocols: WebSocket
' @apis: REST API
'
' === 架构模式 ===
' @pattern: API Gateway
' @design-pattern: Observer, Producer-Consumer, Repository, Factory
' @data-flow: Bidirectional, Request-Response
' @communication-style: Asynchronous, Synchronous
'
' === 分布式特性 ===
' @cap-focus: AP (configurable)
' @consistency-model: Eventual Consistency (configurable)
' @consensus-algorithm: Raft, Leader Election
' @partition-strategy: Hash-based, Key-based, Custom partitioning
'
' === 性能与扩展 ===
' @scale: Medium to Large (1K-100K users, 100-10K QPS)
' @scalability: Horizontal scaling, Auto-scaling, Load balancing
' @performance-metrics: Latency: <100ms p99, High throughput
' @optimization-techniques: Indexing
' @throughput: High (100K+ requests/second)
' @latency: Low (<100ms p99)
'
' === 可靠性 ===
' @reliability: Replication, Redundancy, Health checks, Automatic recovery
' @fault-tolerance: Replication, Failover, Health monitoring, Graceful degradation
' @disaster-recovery: Multi-datacenter replication, Backup strategies, RPO/RTO management
' @availability: 99.99% (4 nines)
' @data-durability: 99.999999999% (11 nines) with proper replication
'
' === 安全性 ===
' @security-features: Authentication
' @authentication: OAuth 2.0, JWT, API Keys, SASL
' @authorization: RBAC (Role-Based Access Control), ACLs, Policy-based
' @encryption: TLS (in-transit), Optional encryption at rest
' @compliance: GDPR-ready, SOC2, HIPAA-compatible, PCI-DSS
'
' === 存储 ===
' @storage-type: Log Storage
' @database-type: SQL/Relational, NoSQL, In-Memory, Search Engine
' @caching-strategy: Cache-aside, Write-through, TTL-based expiration
' @data-persistence: Disk-based with WAL, Configurable durability, Snapshot backups
'
' === 监控运维 ===
' @monitoring: ELK Stack
' @logging: Centralized logging (ELK/Splunk), Structured logs, Log aggregation
' @alerting: Prometheus Alertmanager, PagerDuty, Custom alerts, SLA monitoring
' @observability: Metrics (RED/USE), Logs, Distributed tracing (Jaeger/Zipkin)
'
' === 部署 ===
' @deployment: Kubernetes, Docker, Cloud-native, Blue-Green deployment
' @infrastructure: Cloud, On-premise, Hybrid, Multi-cloud
' @cloud-provider: AWS, Azure, GCP, Cloud-agnostic
' @containerization: Docker-ready, Container-friendly
'
' === 成本 ===
' @cost-factors: Compute instances, Storage costs, Network bandwidth, Licensing
' @cost-optimization: Reserved instances, Auto-scaling, Storage tiering, Compression, Resource right-sizing
' @resource-usage: CPU: Medium-High, Memory: Medium-High, Disk I/O: High, Network: Medium
'
' === 复杂度 ===
' @complexity: Medium
' @implementation-difficulty: Medium
' @maintenance-complexity: Medium
'
' === 学习 ===
' @difficulty-level: Intermediate
' @learning-value: Medium to High (practical system design)
' @prerequisites: Database fundamentals, SQL/NoSQL
' @related-concepts: CAP theorem
'
' === 数据特征 ===
' @data-volume: Medium to Large (GBs to TBs)
' @data-velocity: Real-time, High-speed streaming
' @data-variety: Structured, Semi-structured (JSON, Avro)
' @data-model: Document, Key-Value, Relational, Time-series
'
' === 集成 ===
' @integration-points: REST APIs, Message queues, Database connectors, Webhooks
' @third-party-services: Cloud storage, CDN, Payment processors, Analytics services
' @external-dependencies: Minimal external dependencies
'
' === 测试 ===
' @testing-strategy: Unit tests, Integration tests, Load tests, Chaos engineering
' @quality-assurance: CI/CD pipelines, Code review, Static analysis, Performance testing
'
' === 版本 ===
' @version: 1.0 (current design)
' @maturity: Production-ready, Battle-tested
' @evolution-stage: Active development, Continuous improvement
'
' === 关联 ===
' @related-files: See other architecture diagrams in the same directory
' @alternatives: Multiple implementation approaches available
' @comparison-with: Traditional monolithic vs distributed approaches
'
' === 实战 ===
' @real-world-examples: Fortune 500 companies, Tech unicorns, Large-scale enterprises
' @companies-using: Many Fortune 500 companies, Tech giants, Startups
' @production-readiness: Production-ready, Battle-tested at scale, Enterprise-grade
' ==================================================



!include common_style.puml

title Real-time Collaborative Editing System with Operational Transformation

rectangle "Client Layer" {
    component "Web Editor" as webEditor
    component "Mobile Editor" as mobileEditor
    component "Desktop Client" as desktopClient
}

rectangle "Gateway Layer" {
    component "API Gateway" as apiGateway
    component "WebSocket Gateway" as wsGateway
    component "Authentication Service" as authService
}

rectangle "Collaboration Core" {
    component "Operation Transformer" as opTransformer
    component "Conflict Resolver" as conflictResolver
    component "Version Controller" as versionController
    queue "Operation Queue\n(Redis Stream)" as opQueue
}

rectangle "Document Management" {
    component "Document Service" as docService
    component "Permission Service" as permissionService
    component "History Service" as historyService
    component "Search Service" as searchService
}

rectangle "Storage Layer" {
    database "Document Store\n(MongoDB)" as docStore
    database "Operation Log\n(MongoDB)" as opLog
    database "User Data\n(PostgreSQL)" as userDB
    database "Search Index\n(Elasticsearch)" as searchIndex
}

rectangle "Real-time Components" {
    component "Presence Service" as presenceService
    component "Cursor Tracker" as cursorTracker
    component "Change Broadcaster" as changeBroadcaster
    database "Session Store\n(Redis)" as sessionStore
}

' Connections
webEditor --> apiGateway
mobileEditor --> apiGateway
desktopClient --> apiGateway
webEditor --> wsGateway
mobileEditor --> wsGateway
desktopClient --> wsGateway

apiGateway --> authService
wsGateway --> presenceService
wsGateway --> opTransformer

opTransformer --> opQueue
opQueue --> conflictResolver
conflictResolver --> versionController
versionController --> docService

docService --> docStore
docService --> opLog
docService --> searchService
searchService --> searchIndex

presenceService --> sessionStore
cursorTracker --> sessionStore
changeBroadcaster --> wsGateway

permissionService --> userDB
historyService --> opLog

note right of opTransformer
  Operational Transformation
  CRDT implementation
  Consistency maintenance
end note

note right of conflictResolver
  Conflict detection
  Resolution strategies
  State reconciliation
end note

note right of docService
  Document versioning
  Change persistence
  Access control
end note

note right of presenceService
  User presence tracking
  Cursor position sync
  Real-time updates
end note

@enduml 