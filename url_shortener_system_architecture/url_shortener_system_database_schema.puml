@startuml
!define MONGO(x) class x << (M,#3498db) >>

skinparam class {
    BackgroundColor #ecf0f1
    BorderColor #34495e
    ArrowColor #7f8c8d
    FontColor #2c3e50
}
skinparam note {
    BackgroundColor #f9e79f
    BorderColor #f39c12
    FontColor #34495e
}
skinparam linetype ortho
skinparam backgroundColor #FAFAFA

package "MongoDB Collections" #e8f6f3 {
    together {
        MONGO(urls) {
            _id: ObjectId (Primary Key)
            short_code: String (Shard Key)
            original_url: String
            created_at: Date (Index)
            user_id: ObjectId (Index)
            visits_count: Int
            is_active: Boolean
        }

        MONGO(users) {
            _id: ObjectId (Primary Key)
            username: String
            email: String
            password_hash: String
            created_at: Date
            last_login: Date
        }

        MONGO(visits) {
            _id: ObjectId (Primary Key)
            url_id: ObjectId (Shard Key)
            visitor_ip: String
            user_agent: String
            timestamp: Date (Index)
        }
    }

    note bottom of urls
        urls collection:
        - Stores mapping of short codes to original URLs
        - Uses short_code as shard key for optimized query performance
        - Tracks visit count to reduce queries to visits collection
    end note

    note bottom of users
        users collection:
        - Stores user information
        - Used for user authentication and profile management
    end note

    note bottom of visits
        visits collection:
        - Records detailed information for each short URL visit
        - Used for generating visit statistics and analytics reports
        - Uses url_id as shard key to keep related visit records on the same shard
    end note
}

note as N1 #d5f5e3
    NoSQL Design Notes:
    1. This is a MongoDB document model, not a traditional relational database table design
    2. No foreign key constraints; data consistency is maintained at the application level
    3. Shard Keys are used for data distribution and query optimization
    4. Indexes are used to improve query performance
    5. The _id field serves as the Primary Key for each collection
end note

urls -[#7f8c8d]-> users : "belongs to"
urls -[#7f8c8d]-> visits : "has many"

@enduml
