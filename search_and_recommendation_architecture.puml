@startuml Search_Recommendation_Architecture_Optimized
!define LIGHTYELLOW #FFFACD
!define LIGHTGREEN #90EE90
!define LIGHTRED #FFB6C1

skinparam backgroundColor #E6F3FF
skinparam shadowing false
skinparam RoundCorner 8
skinparam ArrowColor 454645
skinparam DefaultFontName Arial
skinparam DefaultFontSize 11

allowmixing

component "Geo-Load Balancer" as GeoLoadBalancer #FFFACD
component "API Gateway" as APIGateway #FFFACD

component "Auth Service" as AuthService #90EE90
component "Search Service" as SearchService #90EE90
component "Recommendation Service" as RecommendationService #90EE90
component "Search Engine" as SearchEngine #FFB6C1
component "Data Analysis" as DataAnalysis #90EE90
component "Cache" as Cache #FFFACD
component "Database" as Database #FFFACD
component "Message Queue" as MessageQueue #FFFACD
component "Logging Service" as LoggingService #90EE90
component "Monitoring Service" as MonitoringService #90EE90
component "Batch Processing" as BatchProcessing #90EE90

' Relationships
GeoLoadBalancer -down-> APIGateway : "1. Global routing"
APIGateway -down-> AuthService : "2. Auth check"
APIGateway -down-> SearchService : "3. Search request"
APIGateway -down-> RecommendationService : "4. Recommendation request"
SearchService -right-> Cache : "5. Cache access"
SearchService -right-> SearchEngine : "6. Query/Index"
RecommendationService -left-> DataAnalysis : "7. Generate"
RecommendationService -left-> Cache : "8. Cache access"
DataAnalysis -down-> Database : "9. User data"
DataAnalysis -down-> MessageQueue : "10. Async tasks"
MessageQueue -down-> RecommendationService : "11. Process tasks"
RecommendationService -down-> BatchProcessing : "12. Trigger batch"
SearchService -down-> LoggingService : "13. Log searches"
RecommendationService -down-> LoggingService : "14. Log recommendations"
MonitoringService -up-> SearchService : "15. Monitor"
MonitoringService -up-> RecommendationService : "16. Monitor"
MonitoringService -up-> MessageQueue : "17. Monitor queue"
MonitoringService -up-> BatchProcessing : "18. Monitor jobs"

note right of Cache : "Key: ProductID\nValue: ProductDetails"
note right of Database : "Indexed for fast retrieval\nRead-optimized"
note right of MessageQueue : "Async processing\nHorizontal scaling"
note left of GeoLoadBalancer : "Low latency routing"
note left of AuthService : "OAuth, JWT support"
note left of LoggingService : "Centralized logging"
note left of MonitoringService : "Real-time alerts"
note left of BatchProcessing : "Periodic large-scale analysis"
note right of SearchEngine : "Performance bottleneck:\nOptimize query processing"
note right of Database : "Scalability concern:\nImplement sharding"

@enduml
