@startuml Optimized Cross-Datacenter Distributed File System Architecture
!define RECTANGLE rectangle
!define DATABASE database
!define CLOUD cloud

skinparam backgroundColor #F0F0F0
skinparam handwritten false
skinparam monochrome false
skinparam defaultFontName Arial
skinparam defaultFontSize 12
skinparam roundCorner 10
skinparam ArrowColor #2C3E50
skinparam ArrowThickness 1.5
skinparam linetype ortho

allowmixing

' Global Components
CLOUD "Global Load Balancer" as GLB #D6EAF8 {
    component "Geo-aware Routing" as GeoRouting
    component "Request Distribution" as ReqDist
}

RECTANGLE "Global Metadata Management" as GMM #AED6F1 {
    component "Cross-DC Metadata Sync" as MetaSync
    component "Global Namespace" as GlobalNS
}

RECTANGLE "Global Admin & Monitoring" as GAM #D5F5E3 {
    component "Cross-DC Monitoring" as CrossDCMon
    component "Disaster Recovery" as DR
    component "Configuration Management" as ConfigMgmt
}

' Data Center 1
RECTANGLE "Data Center 1" as DC1 #FDEBD0 {
    ' Client
    rectangle "Client" as Client1 #A9CCE3

    ' Load Balancer Cluster
    RECTANGLE "Load Balancer Cluster" as LB1 #F5B041 {
        component "Health Check" as HealthCheck1
        component "Request Router" as RequestRouter1
    }

    ' Caching Layer
    RECTANGLE "Caching Layer" as CacheLayer1 #85C1E9 {
        DATABASE "Redis Cluster" as RedisCache1 {
            note right: "Keys:\n- file_path:chunk_id\n- metadata:file_path"
        }
    }

    ' Name Node Cluster
    RECTANGLE "Name Node Cluster" as NameNodeCluster1 #82E0AA {
        DATABASE "Metadata Storage\n(ZooKeeper)" as MetadataStorage1 {
            note right: "Data:\n- File system tree\n- Block mappings\n- Node status"
        }
        component "File System Manager" as FSManager1
        component "Block Manager" as BlockManager1
        component "Replication Manager" as ReplicationManager1
        component "Data Node Manager" as DataNodeManager1
    }

    ' Data Node Clusters
    RECTANGLE "Data Node Cluster" as DataNodeCluster1 #F1948A {
        DATABASE "Primary Storage" as PrimaryStorage1 {
            note right: "Sharding Key: file_id % 2 == 0"
        }
        DATABASE "Replica Storage" as ReplicaStorage1 {
            note right: "Replica of DC2"
        }
    }
}

' Data Center 2 (simplified for brevity)
RECTANGLE "Data Center 2" as DC2 #FDEBD0 {
    rectangle "Client" as Client2 #A9CCE3
    RECTANGLE "Load Balancer Cluster" as LB2 #F5B041
    RECTANGLE "Caching Layer" as CacheLayer2 #85C1E9
    RECTANGLE "Name Node Cluster" as NameNodeCluster2 #82E0AA
    RECTANGLE "Data Node Cluster" as DataNodeCluster2 #F1948A
}

' CDN / Edge Cache
CLOUD "CDN / Edge Cache" as CDN #D2B4DE

' Connections
Client1 --> GLB : "1. Client Request"
Client2 --> GLB : "1. Client Request"
GLB --> LB1 : "2. Route to nearest DC"
GLB --> LB2 : "2. Route to nearest DC"
LB1 --> CacheLayer1 : "3a. Read: Check Cache"
LB1 --> NameNodeCluster1 : "3b. Write: Get Metadata"
CacheLayer1 --> NameNodeCluster1 : "4. Cache Miss"
NameNodeCluster1 --> DataNodeCluster1 : "5. Read/Write Data"
DataNodeCluster1 --> CacheLayer1 : "6. Update Cache"
NameNodeCluster1 <--> GMM : "7. Sync Metadata"
DataNodeCluster1 <--> DataNodeCluster2 : "8. Cross-DC Replication"
GAM --> DC1 : "9. Monitor & Manage"
GAM --> DC2 : "9. Monitor & Manage"
CDN <--> DC1 : "10. Cache Static Content"
CDN <--> DC2 : "10. Cache Static Content"

' Additional notes for explanation
note top of GLB
  Global Load Balancer provides 
  geo-aware routing and ensures 
  even distribution of requests 
  across data centers
end note

note bottom of GMM
  Global Metadata Management 
  ensures consistency of metadata 
  across data centers and manages 
  the global namespace
end note

note bottom of GAM
  Global Admin & Monitoring oversees 
  system health across all data centers, 
  manages configuration, and handles 
  disaster recovery
end note

note bottom of CDN
  CDN / Edge Cache improves 
  read performance for static 
  content across regions
end note

note right of DataNodeCluster1
  Cross-DC replication ensures 
  data availability and disaster 
  recovery capabilities
end note

@enduml