@startuml
skinparam backgroundColor #F0F0F0
skinparam defaultFontName Arial
skinparam defaultFontSize 12
skinparam roundcorner 20
skinparam shadowing true

!define RECTANGLE class

title High-Concurrency Flash Sale System Architecture

' Frontend Layer
RECTANGLE "Web Frontend" as WebFrontend #LightBlue
RECTANGLE "Mobile App" as MobileApp #LightBlue

' Network Layer
RECTANGLE CDN #LightGreen
RECTANGLE ReverseProxy #LightGreen
RECTANGLE LoadBalancer <<Dynamic Load Distribution>> #LightGreen

' Application Layer
RECTANGLE Controller #Orange
RECTANGLE SecurityLayer <<Security Protection>> #Red
RECTANGLE BusinessLogicLayer #Yellow
RECTANGLE "Inventory Management" as InventoryManagement #Yellow
RECTANGLE "Distributed Lock" as DistributedLock #Yellow
RECTANGLE CacheLayer <<High-Performance Cache>> #Cyan
RECTANGLE "Multi-level Cache" as MultiLevelCache #Cyan
RECTANGLE MessageQueue <<Asynchronous & Scalable>> #Purple
RECTANGLE AsyncProcessor <<High-Speed Order Processing>> #Purple

' Data Layer
RECTANGLE DataAccessLayer <<Efficient Data Handling>> #Pink
RECTANGLE DatabaseSharding <<Horizontal Scaling>> #Pink
RECTANGLE DatabaseOptimization <<Indexing & Query Optimization>> #Pink

' System Support
RECTANGLE RateLimiting <<Traffic Control>> #Gray
RECTANGLE TCCTransactionManagement <<Distributed Transaction Control>> #Gray
RECTANGLE CacheWarmup <<Pre-load Hot Data>> #Gray
RECTANGLE MonitoringSystem <<Performance Monitoring & Alerting>> #Gray
RECTANGLE "Service Discovery" as ServiceDiscovery #Gray
RECTANGLE "Configuration Center" as ConfigCenter #Gray
RECTANGLE "Disaster Recovery" as DisasterRecovery #Gray

' Connections
WebFrontend -down-> CDN
MobileApp -down-> CDN
CDN -down-> ReverseProxy
ReverseProxy -right-> LoadBalancer
LoadBalancer -down-> Controller
Controller -down-> SecurityLayer : Security Check
SecurityLayer -down-> BusinessLogicLayer : Verification Passed
BusinessLogicLayer -right-> InventoryManagement : Inventory Control
BusinessLogicLayer -left-> DistributedLock : Concurrency Control
BusinessLogicLayer -down-> CacheLayer : Query/Update Cache
CacheLayer -right-> MultiLevelCache : Local + Distributed Cache
CacheLayer -left-> CacheWarmup : Initialize Hot Data
BusinessLogicLayer -right-> DataAccessLayer : Database Operations
DataAccessLayer -right-> TCCTransactionManagement : Manage Distributed Transactions
BusinessLogicLayer -up-> MessageQueue : Send Order Message
MessageQueue -down-> AsyncProcessor : Asynchronous Processing
AsyncProcessor -down-> DataAccessLayer : Process Orders
DataAccessLayer -down-> DatabaseSharding : Access Database
DatabaseSharding -right-> DatabaseOptimization : Index Optimization
Controller -left-> RateLimiting : Limit Request Frequency
ReverseProxy -down-> LoadBalancer : Dynamic Adjustment
BusinessLogicLayer -up-> MonitoringSystem : Monitor Operations
Controller -up-> ServiceDiscovery : Service Registration & Discovery
BusinessLogicLayer -up-> ConfigCenter : Centralized Configuration Management
DataAccessLayer -left-> DisasterRecovery : Data Backup & Recovery

@enduml
