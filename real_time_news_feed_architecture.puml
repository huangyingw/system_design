@startuml
actor User

package "API Gateway" {
  [API Gateway] as APIGW
}

package "Authentication & Authorization" {
  [Auth Service] as AuthService
}

package "Feed Producer" {
  [Content Management System] as CMS
  [Producer] as Producer
}

package "Message Queue" {
  [Message Queue] as MQ
}

package "Backend Services" {
  [Feed Service] as FeedService
  [User Preferences Service] as PrefService
  [Recommendation Engine] as RecEngine
  [Logging & Monitoring] as Logging
}

package "Storage" {
  [Distributed Cache] as Cache
  [NoSQL Database] as Database
}

package "Feed Consumer" {
  [WebSocket Service] as WSService
  [Push Notification Service] as PushService
  [Consumer] as Consumer
  User --> Consumer : "Get Feed"
}

' API Gateway manages incoming requests
User --> APIGW : "Request Feed / Publish News"
APIGW --> AuthService : "Authenticate & Authorize"
APIGW --> Producer : "Publish News (Authorized)"
Producer --> MQ : "Push News Feed"

' Backend services manage feed generation, personalization, and storage
MQ --> FeedService : "Deliver Feed"
FeedService --> RecEngine : "Generate Personalized Feed"
FeedService --> PrefService : "Fetch User Preferences"
FeedService --> Logging : "Log Feed Generation"
FeedService --> Cache : "Store Hot Feeds"
FeedService --> Database : "Store All Feeds"

' Consumer fetches or receives feeds
Consumer --> APIGW : "Request Latest Feeds (Authenticated)"
APIGW --> FeedService : "Request Feeds"
FeedService --> Cache : "Fetch Hot Feeds"
FeedService --> Database : "Fetch Older Feeds"

' Push and real-time updates to consumers
FeedService --> WSService : "Push Feed to WebSocket"
FeedService --> PushService : "Send Push Notification"
WSService --> Consumer : "Receive Real-time Feed"
PushService --> Consumer : "Receive Feed Notification"

@enduml
