@startuml Blockchain System Design

skinparam backgroundColor #FAFAFA
skinparam handwritten false
skinparam defaultFontName Arial
skinparam defaultFontSize 12
skinparam roundcorner 20
skinparam shadowing true

title Blockchain System Design

' User Layer
rectangle "User Layer" as UserLayer {
    [Light Node]
    [Wallet Application]
    [DApp]
}

' Application Layer
rectangle "Application Layer" as ApplicationLayer {
    [Smart Contract]
    [Chaincode]
    [DApp Backend]
}

' Network Layer
rectangle "Network Layer" as NetworkLayer {
    [P2P Network]
    [Node Discovery]
    [Data Propagation]
}

' Consensus Layer
rectangle "Consensus Layer" as ConsensusLayer {
    [PoW (Proof of Work)]
    [PoS (Proof of Stake)]
    [DPoS (Delegated Proof of Stake)]
    [PBFT (Practical Byzantine Fault Tolerance)]
}

' Data Layer
rectangle "Data Layer" as DataLayer {
    database "Blockchain" as Blockchain {
        [Block Header]
        [Transaction Data]
        [State Tree]
    }
    database "State Database" as StateDB {
        [Account State]
        [Contract State]
    }
}

' Cryptography Layer
rectangle "Cryptography Layer" as CryptographyLayer {
    [Asymmetric Encryption]
    [Hash Function]
    [Digital Signature]
    [Zero-Knowledge Proof]
}

' Virtual Machine
rectangle "Virtual Machine" as VirtualMachine {
    [EVM (Ethereum Virtual Machine)]
    [WASM (WebAssembly)]
}

' Storage Layer
database "Storage Layer" as StorageLayer {
    [Distributed Storage]
    [IPFS]
}

' Monitoring and Management
rectangle "Monitoring and Management" as MonitoringManagement {
    [Block Explorer]
    [Network Monitoring]
    [Performance Analysis]
}

' Connections
UserLayer -down-> ApplicationLayer : Use
ApplicationLayer -down-> NetworkLayer : Deploy/Call
NetworkLayer -down-> ConsensusLayer : Reach Consensus
ConsensusLayer -down-> DataLayer : Write/Read
DataLayer -left-> CryptographyLayer : Use
ApplicationLayer -right-> VirtualMachine : Execute
DataLayer -down-> StorageLayer : Store Data
MonitoringManagement -up-> DataLayer : Monitor

note right of ConsensusLayer
  Consensus Mechanism Features:
  1. PoW: High security, but energy-intensive
  2. PoS: Energy-efficient, but may lead to centralization
  3. DPoS: Efficient, but limited representation
  4. PBFT: High performance, but limited scalability
end note

note left of DataLayer
  Data Structure:
  1. Block: Contains multiple transactions
  2. Transaction: State transition
  3. Merkle Tree: Fast verification
end note

note bottom of CryptographyLayer
  Cryptographic Guarantees:
  1. Immutable transactions
  2. Identity authentication
  3. Data integrity
  4. Privacy protection
end note

@enduml
