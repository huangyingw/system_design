@startuml
!theme plain
skinparam backgroundColor #F0F0F0
skinparam defaultFontName "Arial"
skinparam defaultFontColor #333333
skinparam classFontColor #000000
skinparam classFontSize 14
skinparam classAttributeFontSize 12
skinparam classBorderThickness 1
skinparam arrowThickness 1.5
skinparam arrowColor #666666

skinparam class {
    BackgroundColor<<T>> #4A90E2
    BackgroundColor<<D>> #50C878
    BackgroundColor<<R>> #FF6B6B
    BorderColor #333333
}

' User table
class "User" as U << (T,#4A90E2) >> {
  + user_id: int <<PK>>
  --
  username: varchar <<index>>
  phone_number: varchar <<index>>
  email: varchar <<index>>
  password_hash: varchar
  last_login: datetime
  registration_date: datetime
  status_timestamp: datetime
}

' PrivateChat table
class "PrivateChat" as PC << (T,#4A90E2) >> {
  + chat_id: int <<PK>>
  --
  sender_id: int <<FK>> <<index>>
  recipient_id: int <<FK>> <<index>>
  last_message_id: ObjectId <<FK>>
  last_message_timestamp: datetime <<index>>
}

' GroupChat table
class "GroupChat" as GC << (T,#4A90E2) >> {
  + chat_id: int <<PK>>
  --
  chat_name: varchar
  chat_type: enum ('group', 'channel')
  creation_date: datetime
  last_message_id: ObjectId <<FK>>
  last_message_timestamp: datetime <<index>>
}

' MongoDB Message NoSQL collection
class "MongoDB_Message_NoSQL" as MM << (D,#50C878) >> {
  + message_id: ObjectId <<PK>>
  --
  chat_id: int <<FK>> <<sharding key>>
  sender_user_id: int <<FK>>
  content: text
  timestamp: datetime <<index>>
  type: enum('text', 'photo', 'video', 'document')
}

' GroupMembers table
class "GroupMembers" as GM << (T,#4A90E2) >> {
  + group_id: int <<FK>> <<index>>
  + user_id: int <<FK>> <<index>>
  --
  join_date: datetime
  role: enum ('member', 'admin', 'owner')
}

' UserProfile table
class "UserProfile" as UP << (T,#4A90E2) >> {
  + user_id: int <<FK>> <<PK>>
  --
  avatar: image
  about: text
  last_updated: datetime
}

' Stickers table
class "Stickers" as S << (T,#4A90E2) >> {
  + sticker_id: int <<PK>>
  --
  user_id: int <<FK>> <<index>>
  image: image
  added_date: datetime
}

' Redis Cache
class "RedisCache" as RC << (R,#FF6B6B) >> {
  + User Status and Last Seen
  Key: user:{user_id}:status
  Value: online|offline|last_seen_timestamp
  --
  + Unread Messages Count
  Key: user:{user_id}:unread:{chat_id}
  Value: count
}

' Contacts table
class "Contacts" as C << (T,#4A90E2) >> {
  + user_id: int <<FK>> <<index>>
  + contact_id: int <<FK>> <<index>>
  --
  added_date: datetime
}

U "1" -- "1" PC : Initiates >
U "1" -- "1" PC : < Receives
U "1" -- "n" GC : Participates >
U "1" -- "n" MM : Sends >
PC "1" -- "n" MM : Contains >
GC "1" -- "n" MM : Contains >
GC "1" -- "n" GM : Has >
U "1" -- "1" UP : Has >
U "n" -- "n" GM : Joins >
U "1" -- "n" S : Owns >
U --> RC : Uses for\nfrequent updates >
U "n" -- "n" C : Has >

@enduml
