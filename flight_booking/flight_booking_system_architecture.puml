@startuml
!define RECTANGLE class
skinparam rectangle {
  BackgroundColor<<microservice>> LightBlue
  BorderColor<<microservice>> Blue
}

skinparam linetype ortho
skinparam nodesep 100
skinparam ranksep 100
skinparam dpi 150

RECTANGLE "User Interface (UI)" as UI <<microservice>> {
  note left
    - Allows users to search flights
    - Displays available options
    - Handles booking process
  end note
}

RECTANGLE "Flight Search Service (FSS)" as FSS <<microservice>> {
  note right
    - Handles flight search requests
    - Queries Cache first
    - Retrieves data from the Database if not found in Cache
  end note
}

RECTANGLE "Booking Service (BS)" as BS <<microservice>> {
  note right
    - Manages booking process
    - Verifies flight availability
    - Interacts with Payment Service
    - Stores booking details
  end note
}

RECTANGLE "Payment Service (PS)" as PS <<microservice>> {
  note right
    - Processes payments securely
    - Stores payment transaction data
  end note
}

RECTANGLE "Notification Service (NS)" as NS <<microservice>> {
  note right
    - Sends booking confirmations
    - Notifies users of booking status
  end note
}

RECTANGLE "Airline API Integrator (AAI)" as AAI <<microservice>> {
  note right
    - Integrates with multiple Airline APIs
    - Fetches real-time flight data
    - Updates the Database with latest info
  end note
}

RECTANGLE "Database (DB)" as DB {
  note left
    - Stores flight, booking, and payment data
    - Provides data retrieval for services
  end note
}

RECTANGLE "Scheduled Data Fetcher (SDF)" as SDF <<microservice>> {
  note bottom
    - Periodically queries Airline API Integrator
    - Prefetches and caches flight data
    - Reduces load during peak times
  end note
}

RECTANGLE "Cache" as CACHE <<microservice>> {
  note left
    - Stores frequently accessed flight data
    - Reduces load on Database and API
  end note
}

UI -down-> FSS : "1. Search Flights"
FSS -down-> CACHE : "2. Query Cache"
CACHE -down-> DB : "3. Query DB if not in Cache"
FSS -down-> AAI : "4. Fetch Flight Info if needed"
AAI -down-> "Airline APIs" : "5. Fetch Real-time Data"
AAI -down-> DB : "6. Store Flight Data"
DB -down-> CACHE : "7. Update Cache"
FSS -down-> UI : "8. Return Available Flights"

UI -down-> BS : "9. Select Flight and Book"
BS -down-> FSS : "10. Verify Flight Availability"
BS -down-> DB : "11. Store Booking Data"

BS -down-> PS : "12. Process Payment"
PS -down-> DB : "13. Store Payment Data"
PS -down-> BS : "14. Payment Confirmation"

BS -down-> NS : "15. Send Booking Confirmation"
NS -down-> UI : "16. Notify User"

SDF -down-> AAI : "17. Periodically Fetch Data"
SDF -down-> DB : "18. Cache Flight Data"

@enduml
