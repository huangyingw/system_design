@startuml Comprehensive CDN Architecture
!pragma layout dot
allowmixing

skinparam backgroundColor #F0F0F0
skinparam defaultFontSize 14
skinparam noteFontSize 12
skinparam arrowFontSize 12

rectangle "CDN System Architecture" as CDN #E6E6FA {
    actor "User" as User
    rectangle "DNS Server" as DNSServer #D0E0F0
    rectangle "Global Load Balancer" as GLB #D0E0F0
    rectangle "Origin Server" as Origin #D0E0F0
    
    rectangle "Region 1" as Region1 #E0F0E0 {
        rectangle "Regional Load Balancer 1" as RLB1 #D0E0F0
        rectangle "Edge Server 1" as ES1 #D0E0F0
        component "Cache 1" as Cache1 #F0E0D0
    }
    
    rectangle "Region 2" as Region2 #E0F0E0 {
        rectangle "Regional Load Balancer 2" as RLB2 #D0E0F0
        rectangle "Edge Server 2" as ES2 #D0E0F0
        component "Cache 2" as Cache2 #F0E0D0
    }
    
    rectangle "Cache Decision System" as CDS #D0E0F0
    rectangle "Analytics & Monitoring" as Analytics #D0E0F0
    
    rectangle "CDN Management" as CDNManagement #E0F0E0 {
        component "Pre-Caching Strategy" as PreCache
        component "Cache Synchronization" as Sync
        component "Intelligent Routing" as Routing
        component "Locality Principle" as Locality
    }
}

User -[#green,thickness=2]-> DNSServer : <color:#green>1. User Request
DNSServer -[#blue,thickness=2]-> GLB : <color:#blue>2. DNS Resolution
GLB -[#purple,thickness=2]-> RLB1 : <color:#purple>3. Route to Region
GLB -[#purple,thickness=2]-> RLB2 : <color:#purple>3. Route to Region
RLB1 -[#orange,thickness=2]-> ES1 : <color:#orange>4. Load Balance
RLB2 -[#orange,thickness=2]-> ES2 : <color:#orange>4. Load Balance
ES1 -[#red,thickness=2]-> Cache1 : <color:#red>5. Check Cache
ES2 -[#red,thickness=2]-> Cache2 : <color:#red>5. Check Cache
Cache1 -[#brown,thickness=2]-> CDS : <color:#brown>6. Cache Query
Cache2 -[#brown,thickness=2]-> CDS : <color:#brown>6. Cache Query
CDS -[#gray,thickness=2]-> Origin : <color:#gray>7. Request Origin\n(if not cached)
Origin -[#gray,thickness=2]-> Cache1 : <color:#gray>8. Update Cache
Origin -[#gray,thickness=2]-> Cache2 : <color:#gray>8. Update Cache
ES1 -[#green,thickness=2]-> User : <color:#green>9. Response
ES2 -[#green,thickness=2]-> User : <color:#green>9. Response

CDS -[#darkblue,thickness=2]-> Analytics : <color:#darkblue>10. Data Analysis
Analytics -[#darkblue,thickness=2]-> GLB : <color:#darkblue>11. Optimize Decisions

CDNManagement -[#purple,thickness=2]-> Cache1 : <color:#purple>Manage

note right of CDNManagement
  System Optimization:
  1. Real-time CDN performance analysis
  2. Optimize routing decisions
  3. Intelligent pre-caching
  4. Improve cache hit rates
  5. Edge computing for simple requests
  6. Multi-level caching strategy
  7. Security: DDoS protection, encryption
end note

note bottom of ES2
  Composite Cache Key:
  - Hostname
  - Path
  - Query String
  - Request Headers
end note

@enduml
