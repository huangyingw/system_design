@startuml Recommendation System

!include common_style.puml

title Recommendation System with Real-time Personalization

rectangle "Client Layer" {
    component "Web Interface" as webUI
    component "Mobile App" as mobileApp
    component "API Gateway" as apiGateway
}

rectangle "Real-time Processing" {
    component "Event Processor" as eventProcessor
    component "Feature Service" as featureService
    component "Prediction Service" as predictionService
    queue "Event Stream\n(Kafka)" as eventStream
}

rectangle "Model Layer" {
    component "Model Registry" as modelRegistry
    component "Model Serving" as modelServing
    component "A/B Testing" as abTesting
    component "Model Monitor" as modelMonitor
}

rectangle "Offline Processing" {
    component "Feature Engineering" as featureEng
    component "Model Training" as modelTraining
    component "Data Pipeline" as dataPipeline
    database "Training Data\n(S3/HDFS)" as trainingData
}

rectangle "Storage Layer" {
    database "User Profiles\n(MongoDB)" as userDB
    database "Item Catalog\n(PostgreSQL)" as itemDB
    database "Feature Store\n(Redis)" as featureStore
    database "Model Cache\n(Redis)" as modelCache
}

rectangle "Analytics" {
    component "Metrics Collector" as metricsCollector
    component "Performance Analyzer" as perfAnalyzer
    database "Analytics Store\n(ClickHouse)" as analyticsDB
}

' Connections
webUI --> apiGateway
mobileApp --> apiGateway
apiGateway --> eventProcessor
apiGateway --> predictionService

eventProcessor --> eventStream
eventStream --> featureService
eventStream --> metricsCollector

featureService --> featureStore
featureService --> userDB
featureService --> itemDB

predictionService --> modelServing
predictionService --> abTesting
modelServing --> modelCache
modelServing --> modelRegistry

eventStream --> dataPipeline
dataPipeline --> trainingData
trainingData --> featureEng
featureEng --> modelTraining
modelTraining --> modelRegistry

metricsCollector --> analyticsDB
perfAnalyzer --> analyticsDB
modelMonitor --> analyticsDB

note right of featureService
  Real-time feature computation
  Feature serving
  Feature versioning
end note

note right of predictionService
  Model inference
  Ensemble predictions
  Serving policy
end note

note right of modelTraining
  Distributed training
  Hyperparameter tuning
  Model evaluation
end note

note right of abTesting
  Experiment management
  Traffic splitting
  Statistical analysis
end note

@enduml 