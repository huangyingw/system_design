@startuml YouTube Data Model
' ==================== Metadata ====================
' @category: video-streaming
' @tags: #database, #youtube, #redis
' @application: YouTube
' @tech-stack: Redis
' @pattern: Architecture
' @description: Youtube Video Metadata And User Interaction Data Schema
' ==================================================


' Color scheme
skinparam backgroundColor #2E3440
skinparam defaultFontColor #ECEFF4
skinparam class {
  BackgroundColor #3B4252
  ArrowColor #88C0D0
  BorderColor #81A1C1
  FontColor #E5E9F0
}
skinparam packageBackgroundColor #2E3440
skinparam packageBorderColor #5E81AC
skinparam stereotypeCBackgroundColor #EBCB8B
skinparam stereotypeCBorderColor #D08770

' Layout
left to right direction
skinparam nodesep 60
skinparam ranksep 60

' Main entities
package "Core Entities" {
  class User {
    +id : int <<PK>>
    +username : varchar
    +password : varchar
    +email : varchar
    +created_at : datetime
  }

  class Video <<NoSQL>> {
    +id : string <<PK>>
    +user_id : string <<Shard-Key>>
    +title : string
    +description : text
    +upload_date : timestamp
    +video_path : string
    +status : string
  }

  class Tag {
    +id : int <<PK>>
    +name : varchar
  }
}

' Interaction entities
package "Interaction Entities" {
  class VideoTag {
    +video_id : string <<FK>>
    +tag_id : int <<FK>>
    +created_at : timestamp
  }

  class Comment <<NoSQL>> {
    +id : string <<PK>>
    +video_id : string <<Shard-Key>>
    +user_id : string
    +text : text
    +created_at : timestamp
  }

  class VideoView <<NoSQL>> {
    +video_id : string <<Composite Shard-Key>>
    +user_id : string
    +view_date : timestamp <<Composite Shard-Key>>
  }

  class VideoRating <<NoSQL>> {
    +video_id : string <<Composite Shard-Key>>
    +user_id : string <<Composite Shard-Key>>
    +rating : int
    +created_at : timestamp
  }
}

' Cache entities
package "Cache Entities" {
  class SessionToken <<Redis>> {
    +user_id : string <<FK>>
    +token : string
  }

  class VideoStatusCache <<Redis>> {
    +video_id : string <<FK>>
    +status : string
  }

  class CommentCountCache <<Redis>> {
    +video_id : string <<FK>>
    +count : int
  }

  class RecentViewsCache <<Redis>> {
    +user_id : string <<FK>>
    +video_ids : string
  }

  class RatingCountCache <<Redis>> {
    +video_id : string <<FK>>
    +count : int
  }
}

' Relationships
User "1" -- "N" Video : Owns >
User "1" -- "N" Comment : Creates >
User "1" -- "N" VideoView : Records User >
User "1" -- "N" VideoRating : Rates >

Video "1" -- "N" VideoTag
Video "1" -- "N" Comment : Includes >
Video "1" -- "N" VideoView : Records View >
Video "1" -- "N" VideoRating : Includes Rating >

Tag "1" -- "N" VideoTag

' Cache relationships
Video ..> VideoStatusCache : Cache >
User ..> SessionToken : Cache >
Comment ..> CommentCountCache : Counts >
VideoView ..> RecentViewsCache : Cache >
VideoRating ..> RatingCountCache : Cache >

@enduml
