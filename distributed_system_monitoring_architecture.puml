@startuml Distributed System Monitoring Architecture

skinparam backgroundColor #FAFAFA
skinparam handwritten false
skinparam defaultFontName Arial
skinparam defaultFontSize 12
skinparam roundcorner 20
skinparam shadowing true
allowmixing

title Distributed System Monitoring Architecture

' 监控代理
rectangle "Monitoring Agent" as Agent #4EC9B0 {
    component "Metric Collector" #9CDCFE
    component "Log Collector" #9CDCFE
    component "Health Checker" #9CDCFE
}

' 数据收集和传输
queue "Message Queue" as MQ #DCDCAA
component "Data Ingestion Service" as Ingestion #FF6B6B

' 数据存储
database "Time Series DB\n(Metrics)" as TSDB #CE9178
database "Log Storage\n(Event Logs)" as LogDB #CE9178

' 数据处理和分析
rectangle "Data Processing" as Processing #4EC9B0 {
    component "Stream Processing" #9CDCFE
    component "Batch Processing" #9CDCFE
    component "Log Analyzer" #9CDCFE
    component "Metric Analyzer" #9CDCFE
}

' 告警系统
rectangle "Alert Manager" as AlertManager #FF6B6B {
    component "Rule Engine" #9CDCFE
    component "Notification Service" #9CDCFE
}

' 可视化
rectangle "Visualization" as Viz #4EC9B0 {
    component "Dashboard" #9CDCFE
    component "Report Generator" #9CDCFE
}

' API网关
rectangle "API Gateway" as Gateway

' 用户界面
actor "Admin/User" as User

' 关系
Agent -down-> MQ : Send data
MQ -down-> Ingestion : Consume data
Ingestion -down-> TSDB : Store metrics
Ingestion -down-> LogDB : Store logs
TSDB -right-> Processing : Query metrics
LogDB -right-> Processing : Query logs
Processing -up-> AlertManager : Trigger alerts
Processing -down-> Viz : Provide processed data

' 数据存储之间的关系
LogDB ..> TSDB : Extract metrics

note right of TSDB
  Stores time-based numerical data
  E.g., CPU usage, memory usage, request count
end note

note right of LogDB
  Stores detailed event logs
  E.g., error messages, access logs, system events
end note

note bottom of LogDB
  Some log data can be 
  transformed into metrics
  and stored in Time Series DB
end note

note right of Agent
  Deployed on each node/service
  Collects metrics, logs, and health status
end note

note right of AlertManager
  Configurable alert rules
  Multiple notification channels
  (Email, SMS, Slack, etc.)
end note

note right of Viz
  Real-time and historical data visualization
  Customizable dashboards
  Automated reporting
end note

@enduml
