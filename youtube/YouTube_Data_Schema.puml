@startuml YouTube Data Model

' Color scheme
skinparam backgroundColor #2E3440
skinparam defaultFontColor #ECEFF4
skinparam class {
  BackgroundColor #3B4252
  ArrowColor #88C0D0
  BorderColor #81A1C1
  FontColor #E5E9F0
}
skinparam packageBackgroundColor #2E3440
skinparam packageBorderColor #5E81AC
skinparam stereotypeCBackgroundColor #EBCB8B
skinparam stereotypeCBorderColor #D08770

' Layout
left to right direction
skinparam nodesep 60
skinparam ranksep 60

' Main entities
package "Core Entities" {
  class User {
    +id : int <<PK, Shard-Key>>
    +username : varchar
    +password : varchar
    +email : varchar
    +created_at : datetime
  }

  class Video {
    +id : int <<PK>>
    +user_id : int <<FK, Shard-Key>>
    +title : varchar
    +description : text
    +upload_date : datetime
    +video_path : varchar
    +status : varchar
  }

  class Tag {
    +id : int <<PK>>
    +name : varchar
  }
}

' Interaction entities
package "Interaction Entities" {
  class VideoTag {
    +video_id : int <<FK>>
    +tag_id : int <<FK>>
    +created_at : datetime
  }

  class Comment {
    +id : int <<PK>>
    +video_id : int <<FK, Shard-Key>>
    +user_id : int <<FK>>
    +text : text
    +created_at : datetime
  }

  class VideoView {
    +video_id : int <<PK, FK, Composite Shard-Key>>
    +user_id : int <<PK, FK>>
    +view_date : datetime <<Composite Shard-Key>>
  }

  class VideoRating {
    +video_id : int <<PK, FK, Composite Shard-Key>>
    +user_id : int <<PK, FK>>
    +rating : int <<Composite Shard-Key>>
    +created_at : datetime
  }
}

' Cache entities
package "Cache Entities" {
  class SessionToken <<Redis>> {
    +user_id : int <<FK>>
    +token : varchar
  }

  class VideoStatusCache <<Redis>> {
    +video_id : int <<FK>>
    +status : varchar
  }

  class CommentCountCache <<Redis>> {
    +video_id : int <<FK>>
    +count : int
  }

  class RecentViewsCache <<Redis>> {
    +user_id : int <<FK>>
    +video_ids : varchar
  }

  class RatingCountCache <<Redis>> {
    +video_id : int <<FK>>
    +count : int
  }
}

' Relationships
User "1" -- "N" Video : Owns >
User "1" -- "N" Comment : Creates >
User "1" -- "N" VideoView : Records User >
User "1" -- "N" VideoRating : Rates >

Video "1" -- "N" VideoTag
Video "1" -- "N" Comment : Includes >
Video "1" -- "N" VideoView : Records View >
Video "1" -- "N" VideoRating : Includes Rating >

Tag "1" -- "N" VideoTag

' Cache relationships
Video ..> VideoStatusCache : Cache >
User ..> SessionToken : Cache >
Comment ..> CommentCountCache : Counts >
VideoView ..> RecentViewsCache : Cache >
VideoRating ..> RatingCountCache : Cache >

@enduml
