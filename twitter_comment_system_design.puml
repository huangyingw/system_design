@startuml Twitter Comment System Design

!define FONTNAME Roboto
!define FONTSIZE 12
!define TITLEFONTSIZE 18

skinparam backgroundColor #E0E8F0
skinparam defaultFontName FONTNAME
skinparam defaultFontSize FONTSIZE
skinparam roundcorner 10
skinparam shadowing false
skinparam ArrowColor #2C3E50
skinparam ArrowThickness 1.2
skinparam rectangleBorderColor #34495E
skinparam rectangleBackgroundColor #ECF0F1
skinparam databaseBorderColor #16A085
skinparam databaseBackgroundColor #D1F2EB
skinparam queueBorderColor #8E44AD
skinparam queueBackgroundColor #E8DAEF
skinparam noteBorderColor #F39C12
skinparam noteBackgroundColor #FCF3CF

title <font size=TITLEFONTSIZE>Optimized Twitter Comment System Design</font>

rectangle "User Interface" as UI {
    [Web & Mobile Apps]
}

cloud "CDN" as CDN

rectangle "API Gateway" as APIGateway {
    [Load Balancer]
    [Auth & Rate Limiting]
}

rectangle "Microservices" as Microservices {
    [Comment Service]
    [User Service]
    [Tweet Service]
    [Notification Service]
    [Moderation Service]
}

database "Data Storage" as DataStorage {
    [Comment DB]
    [User DB]
    [Tweet DB]
}

rectangle "Cache Layer" as CacheLayer {
    [Redis Cluster]
}

queue "Message Queue" as MessageQueue {
    [Kafka]
}

database "Search Engine" as SearchEngine {
    [Elasticsearch]
}

rectangle "ML & Analytics" as MLAnalytics {
    [Sentiment Analysis]
    [Content Recommendation]
}

rectangle "Monitoring" as Monitoring {
    [Prometheus]
    [ELK Stack]
}

UI -down-> CDN
CDN -down-> APIGateway
APIGateway -down-> Microservices
Microservices -right-> CacheLayer
Microservices -down-> DataStorage
Microservices -left-> MessageQueue
Microservices -right-> SearchEngine
Microservices -up-> MLAnalytics
Microservices --> Monitoring

note right of UI
  Features:
  - Real-time updates
  - Infinite scrolling
  - Rich text editor
end note

note right of APIGateway
  - Rate limiting
  - Authentication
  - Load balancing
end note

note right of Microservices
  Comment Service:
  - CRUD operations
  - Tree structure
  - Sorting & pagination
end note

note bottom of DataStorage
  - Sharding by tweet_id
  - Multi-region replication
  - Data encryption
end note

note bottom of CacheLayer
  key: tweet_id
  value: {comments, user_info}
end note

note bottom of MLAnalytics
  - Spam detection
  - Content moderation
  - Trend analysis
end note

@enduml