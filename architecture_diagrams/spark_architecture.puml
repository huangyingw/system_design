@startuml
skinparam backgroundColor #D3D3D3

package "Spark on Kubernetes Application" {
    [Driver Program\n(Scala, Java, Python, R)] as Driver
        [SparkContext\n(Scala, Java, Python, R)] as SC
        [DAG Scheduler\n(Scala)] as DAG
        [Task Scheduler\n(Scala)] as TS

    package "Kubernetes Cluster" {
        [Kubernetes Master\n(Java, Scala)] as K8sMaster
        [Kubernetes API] as K8sAPI
    }

    package "Kubernetes Worker Node 1" {
        [Pod 1\n(Kubernetes)] as Pod1
        [Executor 1\n(Scala, Java, Python, R)] as E1
        [Cache 1] as C1
        [Task 1.1\n(Scala, Java, Python, R)] as T11
        [Task 1.2\n(Scala, Java, Python, R)] as T12
    }

    package "Kubernetes Worker Node 2" {
        [Pod 2\n(Kubernetes)] as Pod2
        [Executor 2\n(Scala, Java, Python, R)] as E2
        [Cache 2] as C2
        [Task 2.1\n(Scala, Java, Python, R)] as T21
        [Task 2.2\n(Scala, Java, Python, R)] as T22
    }

    database "Data Storage System\n(Java)" as Storage {
        [HDFS\n(Java)]
        [Elasticsearch]
        [Other Sources] as Others
    }
}

Driver --> SC : Use
SC --> DAG : Convert to DAG
SC --> TS : Submit Tasks
SC --> K8sAPI : Deploy Driver/Executors
DAG --> TS : Execution Planning
TS --> K8sAPI : Request Executors
K8sMaster --> Pod1 : Schedule Pod
K8sMaster --> Pod2 : Schedule Pod
Pod1 --> E1 : Run Executor
E1 --> C1 : Data Caching
E1 --> T11 : Execute Task
E1 --> T12 : Execute Task
Pod2 --> E2 : Run Executor
E2 --> C2 : Data Caching
E2 --> T21 : Execute Task
E2 --> T22 : Execute Task
E1 --> Storage : Read/Write Data
E2 --> Storage : Read/Write Data

note right of DAG
  DAG (Directed Acyclic Graph) represents:
  - Data processing steps and their dependencies
  - Optimizes task execution
  - Provides a fault-tolerance mechanism
  - No cyclic dependencies in the workflow
  - Basis for execution planning and optimization
end note

note right of Elasticsearch
  Elasticsearch is used for:
  - Full-text Search and Complex Queries
  - Real-time Analysis and Dashboards
  - Log and Event Data Analysis
  - Big Data Integration
  - Data Enrichment
end note

note top of C1
  Cache for Accelerating Data Access
  Supports Various Persistence Levels
end note

note right of Storage
  External Persistent Storage System
  Provides Long-term Data Storage and Fault Tolerance
end note

note right of K8sMaster
  Kubernetes Master:
  - Manages the Kubernetes Cluster
  - Schedules and Orchestrates Pods
  - Provides Cluster Management Capabilities
end note

note right of E1
  Executors run in Kubernetes Pods
  Each Pod represents a Spark Executor
  Pods are managed by Kubernetes
  Executors perform Tasks and may have local Cache
end note

@enduml
