@startuml ' ==================== Metadata ====================
' ==================== Enhanced Metadata ====================
' === 基础分类 ===
' @category: infrastructure
' @subcategory: container-orchestration
' @tags: #kubernetes, #containers, #orchestration, #cloud-native
' @description: Spark Kubernetes Architecture
'
' === 应用场景 ===
' @application: Uber
' @industry: General, Enterprise
' @use-cases: Real-time Processing, Data Analytics, Search & Discovery, Log Aggregation
' @business-value: Improved scalability, High availability, Better performance, Cost efficiency
'
' === 技术栈 ===
' @tech-stack: Elasticsearch, Kubernetes, Apache Spark
' @programming-languages: JavaScript/Node.js
' @frameworks: Framework-agnostic
' @protocols: HTTP/REST, TCP
' @apis: REST API
'
' === 架构模式 ===
' @pattern: Event-Driven Architecture
' @design-pattern: Observer, Producer-Consumer, Repository, Factory
' @data-flow: Bidirectional, Request-Response
' @communication-style: Event-driven
'
' === 分布式特性 ===
' @cap-focus: AP (configurable)
' @consistency-model: Eventual Consistency (configurable)
' @consensus-algorithm: Raft, Leader Election
' @partition-strategy: Hash-based, Key-based, Custom partitioning
'
' === 性能与扩展 ===
' @scale: Medium to Large (1K-100K users, 100-10K QPS)
' @scalability: Horizontal scaling, Auto-scaling, Load balancing
' @performance-metrics: Latency: <100ms p99, High throughput
' @optimization-techniques: Caching
' @throughput: High (100K+ requests/second)
' @latency: Low (<100ms p99)
'
' === 可靠性 ===
' @reliability: Replication, Redundancy, Health checks, Automatic recovery
' @fault-tolerance: Replication, Failover, Health monitoring, Graceful degradation
' @disaster-recovery: Multi-datacenter replication, Backup strategies, RPO/RTO management
' @availability: 99.9% (3 nines)
' @data-durability: 99.999999999% (11 nines) with proper replication
'
' === 安全性 ===
' @security-features: Authentication, Authorization, Encryption, Audit logging
' @authentication: OAuth 2.0, JWT, API Keys, SASL
' @authorization: RBAC (Role-Based Access Control), ACLs, Policy-based
' @encryption: TLS (in-transit), Optional encryption at rest
' @compliance: GDPR-ready, SOC2, HIPAA-compatible, PCI-DSS
'
' === 存储 ===
' @storage-type: Log Storage
' @database-type: Search Engine, Graph Database
' @caching-strategy: Cache-aside, Write-through, TTL-based expiration
' @data-persistence: Disk-based with WAL, Configurable durability, Snapshot backups
'
' === 监控运维 ===
' @monitoring: ELK Stack
' @logging: Centralized logging (ELK/Splunk), Structured logs, Log aggregation
' @alerting: Prometheus Alertmanager, PagerDuty, Custom alerts, SLA monitoring
' @observability: Metrics (RED/USE), Logs, Distributed tracing (Jaeger/Zipkin)
'
' === 部署 ===
' @deployment: Kubernetes
' @infrastructure: Cloud, On-premise, Hybrid, Multi-cloud
' @cloud-provider: AWS, Azure, GCP, Cloud-agnostic
' @containerization: Docker, Kubernetes (StatefulSets, Deployments), Helm charts
'
' === 成本 ===
' @cost-factors: Compute instances, Storage costs, Network bandwidth, Licensing
' @cost-optimization: Reserved instances, Auto-scaling, Storage tiering, Compression, Resource right-sizing
' @resource-usage: CPU: Medium-High, Memory: Medium-High, Disk I/O: High, Network: Medium
'
' === 复杂度 ===
' @complexity: Medium
' @implementation-difficulty: Medium
' @maintenance-complexity: Medium
'
' === 学习 ===
' @difficulty-level: Intermediate
' @learning-value: Medium to High (practical system design)
' @prerequisites: Distributed systems basics, Containerization, Orchestration
' @related-concepts: CAP theorem, Event sourcing, CQRS, Caching strategies, Cache invalidation
'
' === 数据特征 ===
' @data-volume: Medium to Large (GBs to TBs)
' @data-velocity: Real-time, High-speed streaming
' @data-variety: Structured, Semi-structured (JSON, Avro)
' @data-model: Document, Key-Value, Relational, Time-series
'
' === 集成 ===
' @integration-points: REST APIs, Message queues, Database connectors, Webhooks
' @third-party-services: Cloud storage, CDN, Payment processors, Analytics services
' @external-dependencies: Minimal external dependencies
'
' === 测试 ===
' @testing-strategy: Unit tests, Integration tests, Load tests, Chaos engineering
' @quality-assurance: CI/CD pipelines, Code review, Static analysis, Performance testing
'
' === 版本 ===
' @version: 1.0 (current design)
' @maturity: Production-ready, Battle-tested
' @evolution-stage: Active development, Continuous improvement
'
' === 关联 ===
' @related-files: See other architecture diagrams in the same directory
' @alternatives: Multiple implementation approaches available
' @comparison-with: Traditional monolithic vs distributed approaches
'
' === 实战 ===
' @real-world-examples: Google, Spotify, Pinterest
' @companies-using: Google, Spotify, Pinterest
' @production-readiness: Production-ready, Battle-tested at scale, Enterprise-grade
' ==================================================


!pragma layout dot
skinparam backgroundColor #F0F0F0
allowmixing

rectangle "Spark Application" as SparkApp #FDD835 {
    component "Driver Program" as Driver
    component "SparkContext" as SC
    component "RDD Operations" as RDDOps
    component "DAG Scheduler" as DAG
    component "Task Scheduler" as TS
}

rectangle "Kubernetes Cluster" as K8sCluster #7CB342 {
    component "Kubernetes Master" as K8sMaster
    component "Kubernetes API" as K8sAPI
}

rectangle "Worker Node 1" as Node1 #4A86E8 {
    component "Pod 1" as Pod1
    component "Executor 1" as E1
    component "Cache 1" as C1
    rectangle "Data Processing 1" as LDP1 #8E24AA {
        component "Map Task 1.1" as MT11
        component "Reduce Task 1.2" as RT12
    }
}

rectangle "Worker Node 2" as Node2 #4A86E8 {
    component "Pod 2" as Pod2
    component "Executor 2" as E2
    component "Cache 2" as C2
    rectangle "Data Processing 2" as LDP2 #8E24AA {
        component "Map Task 2.1" as MT21
        component "Reduce Task 2.2" as RT22
    }
}

component "Final Reduce" as FinalReduce #FB8C00

rectangle "Data Storage" as Storage #E53935 {
    component "HDFS" as HDFS
    component "Elasticsearch" as ES
    component "Other Sources" as Others
}

Driver -[#78909C,thickness=2]-> SC : <color:#78909C>1. Initialize
SC -[#78909C,thickness=2]-> RDDOps : <color:#78909C>2. Define
RDDOps -[#78909C,thickness=2]-> DAG : <color:#78909C>3. Convert
SC -[#78909C,thickness=2]-> TS : <color:#78909C>4. Submit
SC -[#78909C,thickness=2]-> K8sAPI : <color:#78909C>5. Deploy
DAG -[#78909C,thickness=2]-> TS : <color:#78909C>6. Plan
TS -[#78909C,thickness=2]-> K8sAPI : <color:#78909C>7. Request
K8sMaster -[#7CB342,thickness=2]-> Pod1 : <color:#7CB342>8. Schedule
K8sMaster -[#7CB342,thickness=2]-> Pod2 : <color:#7CB342>9. Schedule
Pod1 -[#4A86E8,thickness=2]-> E1 : <color:#4A86E8>10. Run
E1 -[#4A86E8,thickness=2]-> C1 : <color:#4A86E8>11. Cache
E1 -[#8E24AA,thickness=2]-> MT11 : <color:#8E24AA>12. Map
MT11 -[#8E24AA,thickness=2]-> RT12 : <color:#8E24AA>13. Reduce
Pod2 -[#4A86E8,thickness=2]-> E2 : <color:#4A86E8>14. Run
E2 -[#4A86E8,thickness=2]-> C2 : <color:#4A86E8>15. Cache
E2 -[#8E24AA,thickness=2]-> MT21 : <color:#8E24AA>16. Map
MT21 -[#8E24AA,thickness=2]-> RT22 : <color:#8E24AA>17. Reduce
RT12 -[#FB8C00,thickness=2]-> FinalReduce : <color:#FB8C00>18. Aggregate
RT22 -[#FB8C00,thickness=2]-> FinalReduce : <color:#FB8C00>19. Aggregate
FinalReduce -[#E53935,thickness=2]-> Storage : <color:#E53935>20. Store

note right of RDDOps
  RDD Operations:
  - Define processing logic
  - Transformations and actions
  - Lazy evaluation
  - Distributed processing basis
end note

note right of DAG
  DAG (Directed Acyclic Graph):
  - Represents processing steps
  - Optimizes execution
  - Ensures fault-tolerance
  - No cyclic dependencies
end note

note right of ES
  Elasticsearch:
  - Full-text search
  - Real-time analysis
  - Log and event data processing
  - Data enrichment
end note

note top of C1
  Cache:
  key: value pairs
  Accelerates data access
end note

note right of Storage
  External Storage:
  Long-term data persistence
  Fault tolerance
end note

note right of K8sMaster
  Kubernetes Master:
  - Manages cluster
  - Schedules and orchestrates Pods
  - Overall cluster management
end note

note right of E1
  Executors:
  - Run in Kubernetes Pods
  - Managed by Kubernetes
  - Execute tasks
  - Local caching capability
end note

note right of FinalReduce
  Final Reduce:
  - Aggregates results
  - Performs final processing
  - Prepares for storage
end note

@enduml