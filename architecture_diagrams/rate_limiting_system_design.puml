@startuml
skinparam backgroundColor #ECECEC
skinparam linetype ortho

rectangle "API Gateway / Load Balancer" as LB
rectangle "Rate Limiter Service" as RLS
rectangle "Rules Engine" as RE
rectangle "PostgreSQL\n<database>" as PG
rectangle "Redis Cache\n<queue>" as RC

LB -down-> RLS : Requests
RLS -right-> RE : Check Rules
RLS -down-> RC : Check/Update Counters
RE -down-> PG : Fetch/Update Rules
RE -left-> RC : Cache Rules

note right of LB
  Distributes incoming requests
  across multiple instances
end note

note right of RLS
  Checks and enforces rate limits
  Scales horizontally for high throughput
end note

note right of RE
  Manages and applies rate limiting rules
  Cached for performance
end note

note right of RC
  Stores: 
  - Request counters
  - Cached rules
  Key structure:
  user:{userID}:endpoint:{endpoint}:counter
end note

note right of PG
  Stores:
  - Rate limiting rules
  - User data
  - Request logs
end note

@enduml
