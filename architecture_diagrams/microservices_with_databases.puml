@startuml MongoDB Sharded Cluster Architecture

skinparam backgroundColor #F0F0F0
skinparam handwritten false
skinparam monochrome false
skinparam packageStyle rectangle
skinparam packageBackgroundColor #EEEBDC
skinparam componentStyle uml2

!define MICROSERVICE(x) component x <<Microservice>> #ADD1B2
!define MONGOS(x) database x <<Mongos>> #A9DCDF
!define SHARD(x) database x <<Shard>> #FFBD9D
!define REPLICANODE(x) database x <<ReplicaNode>> #FFF59D
!define CONFIGSVR(x) database x <<ConfigServer>> #C8F2AD

skinparam component {
    FontColor #000000
    BackgroundColor<<Microservice>> #ADD1B2
    BorderColor<<Microservice>> #94ABD9
}

' 应用服务
package "Application Layer" {
    MICROSERVICE(Service1)
    MICROSERVICE(Service2)
}

' 路由层
package "Router Layer" {
    MONGOS(Mongos1)
    MONGOS(Mongos2)
}

' 数据存储层
package "Data Storage Layer" {
    package "Shard 1 (Replica Set)" {
        SHARD(Shard1_Primary)
        REPLICANODE(Shard1_Secondary1)
        REPLICANODE(Shard1_Secondary2)
    }
    package "Shard 2 (Replica Set)" {
        SHARD(Shard2_Primary)
        REPLICANODE(Shard2_Secondary1)
        REPLICANODE(Shard2_Secondary2)
    }
    package "Shard 3 (Replica Set)" {
        SHARD(Shard3_Primary)
        REPLICANODE(Shard3_Secondary1)
        REPLICANODE(Shard3_Secondary2)
    }
}

' 配置服务器
package "Config Server Replica Set" {
    CONFIGSVR(ConfigServer1)
    CONFIGSVR(ConfigServer2)
    CONFIGSVR(ConfigServer3)
}

' 连接关系
Service1 -down-> Mongos1 : 查询
Service2 -down-> Mongos2 : 查询

Mongos1 -down-> Shard1_Primary
Mongos1 -down-> Shard2_Primary
Mongos1 -down-> Shard3_Primary
Mongos2 -down-> Shard1_Primary
Mongos2 -down-> Shard2_Primary
Mongos2 -down-> Shard3_Primary

Mongos1 -right-> ConfigServer1
Mongos1 -right-> ConfigServer2
Mongos1 -right-> ConfigServer3
Mongos2 -left-> ConfigServer1
Mongos2 -left-> ConfigServer2
Mongos2 -left-> ConfigServer3

' 副本集内部复制关系
Shard1_Primary <-right-> Shard1_Secondary1 : 复制
Shard1_Primary <-down-> Shard1_Secondary2 : 复制
Shard2_Primary <-right-> Shard2_Secondary1 : 复制
Shard2_Primary <-down-> Shard2_Secondary2 : 复制
Shard3_Primary <-right-> Shard3_Secondary1 : 复制
Shard3_Primary <-down-> Shard3_Secondary2 : 复制

@enduml
