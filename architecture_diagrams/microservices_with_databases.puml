@startuml MongoDB Sharded Cluster Architecture

skinparam backgroundColor #F0F0F0
skinparam handwritten false
skinparam monochrome false
skinparam packageStyle rectangle
skinparam packageBackgroundColor #EEEBDC
skinparam componentStyle uml2

!define MICROSERVICE(x) component x <<Microservice>> #ADD1B2
!define MONGOS(x) database x <<Mongos>> #A9DCDF
!define SHARD(x) database x <<Shard>> #FFBD9D
!define REPLICANODE(x) database x <<ReplicaNode>> #FFF59D
!define CONFIGSVR(x) database x <<ConfigServer>> #C8F2AD

skinparam component {
    FontColor #000000
    BackgroundColor<<Microservice>> #ADD1B2
    BorderColor<<Microservice>> #94ABD9
}

' Application Layer
package "Application Layer" {
    MICROSERVICE(Service1)
    MICROSERVICE(Service2)
    note right of Service2
        Scalable
        Can add more service instances as needed
    end note
}

' Router Layer
package "Router Layer" {
    MONGOS(Mongos1)
    MONGOS(Mongos2)
    note right of Mongos2
        Scalable
        Multiple Mongos instances provide
        load balancing and high availability
    end note
}

' Data Storage Layer
package "Data Storage Layer" {
    package "Shard 1 (Replica Set)" {
        SHARD(Shard1_Primary)
        REPLICANODE(Shard1_Secondary1)
        REPLICANODE(Shard1_Secondary2)
    }
    package "Shard 2 (Replica Set)" {
        SHARD(Shard2_Primary)
        REPLICANODE(Shard2_Secondary1)
        REPLICANODE(Shard2_Secondary2)
    }
    package "Shard 3 (Replica Set)" {
        SHARD(Shard3_Primary)
        REPLICANODE(Shard3_Secondary1)
        REPLICANODE(Shard3_Secondary2)
    }
    note right of Shard3_Secondary2
        Scalable
        Can add more shards to increase
        storage capacity and processing power
    end note
}

' Config Servers
package "Config Server Replica Set" {
    CONFIGSVR(ConfigServer1)
    CONFIGSVR(ConfigServer2)
    CONFIGSVR(ConfigServer3)
    note right of ConfigServer3
        Fixed number (usually 3)
        Provides high availability
        and data consistency
    end note
}

' Connections
Service1 -down-> Mongos1 : Query
Service2 -down-> Mongos2 : Query

Mongos1 -down-> Shard1_Primary
Mongos1 -down-> Shard2_Primary
Mongos1 -down-> Shard3_Primary
Mongos2 -down-> Shard1_Primary
Mongos2 -down-> Shard2_Primary
Mongos2 -down-> Shard3_Primary

Mongos1 -right-> ConfigServer1
Mongos1 -right-> ConfigServer2
Mongos1 -right-> ConfigServer3
Mongos2 -left-> ConfigServer1
Mongos2 -left-> ConfigServer2
Mongos2 -left-> ConfigServer3

' Replica Set Internal Replication
Shard1_Primary <-right-> Shard1_Secondary1 : Replicate
Shard1_Primary <-down-> Shard1_Secondary2 : Replicate
Shard2_Primary <-right-> Shard2_Secondary1 : Replicate
Shard2_Primary <-down-> Shard2_Secondary2 : Replicate
Shard3_Primary <-right-> Shard3_Secondary1 : Replicate
Shard3_Primary <-down-> Shard3_Secondary2 : Replicate

@enduml
