@startuml
' ==================== Metadata ====================
' @category: distributed-systems
' @tags: #redis
' @application: General
' @tech-stack: Redis
' @pattern: Architecture
' @description: Cohesity Azure Integration Diagram
' ==================================================

skinparam backgroundColor #FAFAFA
skinparam defaultFontName Arial
skinparam defaultFontSize 14
skinparam linetype ortho
skinparam Padding 20
skinparam ParticipantPadding 30
skinparam ComponentPadding 25
skinparam rectanglePadding 30

skinparam rectangle {
    roundCorner 10
    BackgroundColor<<Cohesity>> #E3F2FD
    BorderColor<<Cohesity>> #1E88E5
    BackgroundColor<<Azure>> #E8EAF6
    BorderColor<<Azure>> #3949AB
    BackgroundColor<<ThirdParty>> #FFF3E0
    BorderColor<<ThirdParty>> #FB8C00
}

skinparam arrow {
    Color #616161
    Thickness 1.2
}

skinparam note {
    BackgroundColor #FFFDE7
    BorderColor #FBC02D
}

rectangle "Cohesity" <<Cohesity>> {
    [REST Endpoint]
}

rectangle "Microsoft Azure" <<Azure>> {
    [Producer Function] as Producer
    [Consumer Function] as Consumer
    [Service Bus Queue] as Queue
    [Azure Sentinel] as Sentinel
    [Azure Cache for Redis] as Redis
}

rectangle "Third-party" <<ThirdParty>> {
    [ServiceNow]
}

[REST Endpoint] -right-> Producer : Fetch Data
Producer -down-> Queue : Queue Alerts
Producer <-right-> Redis : Cache Query Times
Queue -right-> Consumer : Process Alerts
Consumer -up-> Sentinel : Create Incidents
Sentinel -down-> ServiceNow : Create Tickets

note top of [REST Endpoint]
  Provides alerts and
  security events data
  PK: AlertID
  Index: Timestamp
end note

note bottom of Producer
  - Timer Triggered
  - Transforms raw data
  - Handles rate limiting
  - Auto-scaling enabled
end note

note top of Redis
  Stores:
  - Last query timestamp
  - Query performance metrics
  Key: LastQueryTime
end note

note bottom of Consumer
  - Event-driven
  - Processes alerts in real-time
  - Creates standardized incidents
  - Auto-scaling based on queue length
end note

note bottom of Queue
  - FIFO order
  - Deduplication
  - Transactional support
  - Long-polling for efficiency
  - Partitioned for high throughput
end note

note left of Sentinel
  - Central security management
  - Threat detection & response
  - Utilizes Log Analytics
  - Supports custom analytics rules
end note

note right of ServiceNow
  - Automated ticket creation
  - Integrates with Azure Sentinel
  - Enables workflow automation
  - Supports custom fields and rules
end note

@enduml
