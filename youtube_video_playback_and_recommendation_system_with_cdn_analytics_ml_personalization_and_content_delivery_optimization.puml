@startuml YouTube_Video_Playback_Architecture
' ==================== Metadata ====================
' @category: video-streaming
' @tags: #database, #youtube
' @application: YouTube
' @tech-stack: General
' @pattern: Architecture
' @description: Youtube Video Playback And Recommendation System With Cdn Analytics Ml Personalization And Content Delivery Optimization
' ==================================================

!pragma layout smetana
allowmixing

skinparam backgroundColor #F0F0F0
skinparam defaultFontName Arial
skinparam defaultFontSize 12
skinparam defaultFontColor #333333
skinparam padding 5
skinparam roundCorner 10
skinparam ArrowColor #0066CC
skinparam ArrowThickness 2
skinparam linetype ortho

' 增加组件边框的可见度
skinparam rectangle {
    BorderColor #555555
    BorderThickness 2
}
skinparam component {
    BorderColor #555555
    BorderThickness 2
    BackgroundColor #E1F5FE
}
skinparam database {
    BorderColor #555555
    BorderThickness 2
    BackgroundColor #FFCDD2
}

' Components
rectangle "Client Side" as ClientSide {
    component "User Interface" as UI
    component "Video Player" as VideoPlayer
}

rectangle "Content Delivery" as ContentDelivery {
    component "CDN" as CDN
    component "Edge Servers" as EdgeServers
}

rectangle "Backend Services" as BackendServices {
    component "Streaming Server" as StreamingServer
    component "Analytics Service" as AnalyticsService
    component "Recommendation Engine" as RecommendationEngine
}

rectangle "Data Storage" as DataStorage {
    database "Video Storage" as VideoStorage
    database "User Preferences DB" as UserPrefsDB
    database "Analytics DB" as AnalyticsDB
}

actor "User" as User

' Connections
User -right-> UI : <color:#0066CC>1. Interact</color>
UI -right-> VideoPlayer : <color:#0066CC>2. Request video</color>
VideoPlayer -right-> CDN : <color:#0066CC>3. Request video chunks</color>
CDN -right-> EdgeServers : <color:#0066CC>4. Fetch from nearest</color>
EdgeServers -down-> VideoStorage : <color:#0066CC>5. Retrieve video data</color>
VideoStorage -up-> EdgeServers : <color:#0066CC>6. Return video data</color>
EdgeServers -left-> CDN : <color:#0066CC>7. Cache and return</color>
CDN -left-> VideoPlayer : <color:#0066CC>8. Stream video chunks</color>
VideoPlayer -down-> StreamingServer : <color:#0066CC>9. Request adaptive bitrate</color>
StreamingServer -up-> VideoPlayer : <color:#0066CC>10. Provide optimal bitrate</color>
VideoPlayer -down-> UserPrefsDB : <color:#0066CC>11. Update watch history</color>
VideoPlayer -down-> AnalyticsService : <color:#0066CC>12. Send playback analytics</color>
AnalyticsService -right-> AnalyticsDB : <color:#0066CC>13. Store analytics data</color>
UI -down-> RecommendationEngine : <color:#0066CC>14. Get recommendations</color>
RecommendationEngine -up-> UI : <color:#0066CC>15. Provide recommendations</color>

' Notes
note right of CDN #E0E0E0
  Globally distributed for
  low-latency content delivery
end note

note bottom of StreamingServer #E0E0E0
  Handles adaptive bitrate streaming
  for optimal viewing experience
end note

note bottom of AnalyticsService #E0E0E0
  Processes user engagement
  and performance metrics
end note

note bottom of RecommendationEngine #E0E0E0
  Suggests videos based on
  user history and preferences
end note

@enduml